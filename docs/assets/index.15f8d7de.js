var e=Object.assign;import{p as t,F as i,C as o,g as a,S as n,m as s,J as r,V as l}from"./vendor.9c8c72a9.js";var c,h;!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(i){const o=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((i,n)=>{const s=new URL(e,o);if(self[t].moduleMap[s])return i(self[t].moduleMap[s]);const r=new Blob([`import * as m from '${s}';`,`${t}.moduleMap['${s}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){n(new Error(`Failed to import: ${e}`)),a(l)},onload(){i(self[t].moduleMap[s]),a(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("/assets/"),(h=c||(c={}))[h.NORMAL=1]="NORMAL",h[h.AMBIG=2]="AMBIG",h[h.ALLOPHONE=3]="ALLOPHONE",h[h.OTHER=4]="OTHER";const p=()=>({modelInput:"-^br^pt-",spread:[6,6,6,6,6,6,6],spreadScale:[1,1,1,1,1,1,1],min:-.3,max:1,nreps:1,slicesPerPhon:3,fSlices:99,decay:{F:.01,P:.03,W:.05},rest:{F:-.1,P:-.1,W:-.01},alpha:{IF:1,FP:.02,PW:.05,WP:.03,PF:0},gamma:{F:.04,P:.04,W:.03},deltaInput:6,noiseSD:0,stochasticitySD:0,atten:1,bias:0,learningrate:0,lengthNormalization:0,phonology:[{label:"p",features:[0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1,.2,0,0,0,0,0,0,0],durationScalar:[1,1,1,1,1,1,1],phonologicalRole:c.NORMAL},{label:"b",features:[0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,.2,1,0,0,0,0,0,0,0],durationScalar:[1,1,1,1,1,1,1],phonologicalRole:c.NORMAL},{label:"t",features:[0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,1,.2,0,0,0,0,0],durationScalar:[1,1,1,1,1,1,1],phonologicalRole:c.NORMAL},{label:"d",features:[0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,.2,1,0,0,0,0,0],durationScalar:[1,1,1,1,1,1,1],phonologicalRole:c.NORMAL},{label:"k",features:[0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,.1,.3,1,.3,.1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,.2,0,0,0],durationScalar:[1,1,1,1,1,1,1],phonologicalRole:c.NORMAL},{label:"g",features:[0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,.1,.3,1,.3,.1,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,.2,1,0,0,0],durationScalar:[1,1,1,1,1,1,1],phonologicalRole:c.NORMAL},{label:"s",features:[0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,.3,.1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],durationScalar:[1,1,1,1,1,1,1],phonologicalRole:c.NORMAL},{label:"S",features:[0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,.1,.3,1,.3,.1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],durationScalar:[1,1,1,1,1,1,1],phonologicalRole:c.NORMAL},{label:"r",features:[0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,.5,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],durationScalar:[1,1,1,1,1,1,1],phonologicalRole:c.NORMAL},{label:"l",features:[0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,.5,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],durationScalar:[1,1,1,1,1,1,1],phonologicalRole:c.NORMAL},{label:"a",features:[1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,.1,.3,1,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],durationScalar:[1,1,1,1,1,1,1],phonologicalRole:c.NORMAL},{label:"i",features:[1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,.3,.1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],durationScalar:[1,1,1,1,1,1,1],phonologicalRole:c.NORMAL},{label:"u",features:[1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,.1,.3,1,.3,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],durationScalar:[1,1,1,1,1,1,1],phonologicalRole:c.NORMAL},{label:"^",features:[0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,.1,.3,1,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],durationScalar:[1,1,1,1,1,1,1],phonologicalRole:c.NORMAL},{label:"-",features:[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],durationScalar:[1,1,1,1,1,1,1],phonologicalRole:c.NORMAL}],lexicon:[{phon:"^",freq:23248,prime:0},{phon:"^br^pt",freq:37,prime:0},{phon:"^dapt",freq:71,prime:0},{phon:"^d^lt",freq:50,prime:0},{phon:"^gri",freq:264,prime:0},{phon:"^lat",freq:50,prime:0},{phon:"^part",freq:57,prime:0},{phon:"^pil",freq:108,prime:0},{phon:"ark",freq:50,prime:0},{phon:"ar",freq:4406,prime:0},{phon:"art",freq:274,prime:0},{phon:"art^st",freq:112,prime:0},{phon:"^slip",freq:29,prime:0},{phon:"bar",freq:125,prime:0},{phon:"bark",freq:125,prime:0},{phon:"bi",freq:6382,prime:0},{phon:"bit",freq:87,prime:0},{phon:"bist",freq:50,prime:0},{phon:"blak",freq:118,prime:0},{phon:"bl^d",freq:122,prime:0},{phon:"blu",freq:143,prime:0},{phon:"bab",freq:45,prime:0},{phon:"babi",freq:23,prime:0},{phon:"badi",freq:341,prime:0},{phon:"bust",freq:23,prime:0},{phon:"but",freq:34,prime:0},{phon:"bat^l",freq:95,prime:0},{phon:"baks",freq:87,prime:0},{phon:"brid",freq:25,prime:0},{phon:"brud",freq:26,prime:0},{phon:"br^S",freq:77,prime:0},{phon:"b^b^l",freq:32,prime:0},{phon:"b^k",freq:31,prime:0},{phon:"b^s",freq:34,prime:0},{phon:"b^t",freq:4382,prime:0},{phon:"kar",freq:386,prime:0},{phon:"kard",freq:62,prime:0},{phon:"karp^t",freq:22,prime:0},{phon:"sis",freq:34,prime:0},{phon:"klak",freq:30,prime:0},{phon:"kl^b",freq:171,prime:0},{phon:"klu",freq:25,prime:0},{phon:"kalig",freq:32,prime:0},{phon:"kul",freq:149,prime:0},{phon:"kap",freq:32,prime:0},{phon:"kapi",freq:61,prime:0},{phon:"k^p^l",freq:164,prime:0},{phon:"krip",freq:23,prime:0},{phon:"kru",freq:38,prime:0},{phon:"krap",freq:44,prime:0},{phon:"kruS^l",freq:31,prime:0},{phon:"kru^l",freq:20,prime:0},{phon:"kr^S",freq:23,prime:0},{phon:"k^p",freq:63,prime:0},{phon:"k^t",freq:223,prime:0},{phon:"dark",freq:234,prime:0},{phon:"dart",freq:20,prime:0},{phon:"dil",freq:157,prime:0},{phon:"did",freq:21,prime:0},{phon:"dip",freq:199,prime:0},{phon:"du",freq:1366,prime:0},{phon:"dal",freq:23,prime:0},{phon:"dat",freq:28,prime:0},{phon:"d^b^l",freq:83,prime:0},{phon:"dru",freq:69,prime:0},{phon:"drap",freq:196,prime:0},{phon:"dr^g",freq:58,prime:0},{phon:"d^k",freq:21,prime:0},{phon:"d^l",freq:36,prime:0},{phon:"d^st",freq:78,prime:0},{phon:"duti",freq:95,prime:0},{phon:"ist",freq:183,prime:0},{phon:"it",freq:300,prime:0},{phon:"glu",freq:28,prime:0},{phon:"gad",freq:332,prime:0},{phon:"gat",freq:482,prime:0},{phon:"grik",freq:66,prime:0},{phon:"grit",freq:38,prime:0},{phon:"gru",freq:64,prime:0},{phon:"grup",freq:545,prime:0},{phon:"gard",freq:82,prime:0},{phon:"g^tar",freq:24,prime:0},{phon:"kip",freq:348,prime:0},{phon:"ki",freq:125,prime:0},{phon:"lid",freq:517,prime:0},{phon:"lig",freq:83,prime:0},{phon:"lip",freq:38,prime:0},{phon:"list",freq:343,prime:0},{phon:"lig^l",freq:77,prime:0},{phon:"labi",freq:22,prime:0},{phon:"lak",freq:109,prime:0},{phon:"lup",freq:23,prime:0},{phon:"lus",freq:68,prime:0},{phon:"lat",freq:169,prime:0},{phon:"l^k",freq:49,prime:0},{phon:"l^ki",freq:25,prime:0},{phon:"l^kS^ri",freq:24,prime:0},{phon:"ad",freq:53,prime:0},{phon:"pap^",freq:40,prime:0},{phon:"park",freq:242,prime:0},{phon:"part",freq:625,prime:0},{phon:"parS^l",freq:25,prime:0},{phon:"partli",freq:49,prime:0},{phon:"parti",freq:275,prime:0},{phon:"par",freq:10,prime:0},{phon:"pi",freq:24,prime:0},{phon:"pik",freq:24,prime:0},{phon:"pip^l",freq:887,prime:0},{phon:"pis",freq:221,prime:0},{phon:"plat",freq:57,prime:0},{phon:"pl^g",freq:28,prime:0},{phon:"pl^s",freq:72,prime:0},{phon:"pak^t",freq:64,prime:0},{phon:"p^lis",freq:159,prime:0},{phon:"pal^si",freq:290,prime:0},{phon:"pul",freq:129,prime:0},{phon:"pap",freq:31,prime:0},{phon:"pas^b^l",freq:373,prime:0},{phon:"pas^bli",freq:61,prime:0},{phon:"pat",freq:37,prime:0},{phon:"prist",freq:33,prime:0},{phon:"prab^b^l",freq:24,prime:0},{phon:"prab^bli",freq:261,prime:0},{phon:"pradus",freq:256,prime:0},{phon:"prad^kt",freq:195,prime:0},{phon:"pragr^s",freq:141,prime:0},{phon:"p^t",freq:63,prime:0},{phon:"rid",freq:273,prime:0},{phon:"ril",freq:261,prime:0},{phon:"rili",freq:275,prime:0},{phon:"rab",freq:40,prime:0},{phon:"rak",freq:121,prime:0},{phon:"rak^t",freq:20,prime:0},{phon:"rad",freq:29,prime:0},{phon:"rut",freq:69,prime:0},{phon:"r^b",freq:35,prime:0},{phon:"r^g^d",freq:20,prime:0},{phon:"rul",freq:215,prime:0},{phon:"rupi",freq:20,prime:0},{phon:"r^S",freq:60,prime:0},{phon:"r^s^l",freq:21,prime:0},{phon:"skar",freq:22,prime:0},{phon:"skul",freq:694,prime:0},{phon:"skru",freq:45,prime:0},{phon:"sil",freq:40,prime:0},{phon:"sit",freq:99,prime:0},{phon:"sikr^t",freq:105,prime:0},{phon:"si",freq:809,prime:0},{phon:"sid",freq:84,prime:0},{phon:"sik",freq:128,prime:0},{phon:"Sarp",freq:115,prime:0},{phon:"Si",freq:2860,prime:0},{phon:"Sip",freq:23,prime:0},{phon:"Sit",freq:77,prime:0},{phon:"Sild",freq:21,prime:0},{phon:"Sak",freq:66,prime:0},{phon:"Sut",freq:81,prime:0},{phon:"Sap",freq:108,prime:0},{phon:"Sat",freq:142,prime:0},{phon:"Sr^g",freq:22,prime:0},{phon:"S^t",freq:50,prime:0},{phon:"slip",freq:109,prime:0},{phon:"slit",freq:10,prime:0},{phon:"sl^g",freq:24,prime:0},{phon:"sal^d",freq:90,prime:0},{phon:"sari",freq:49,prime:0},{phon:"spark",freq:20,prime:0},{phon:"spik",freq:259,prime:0},{phon:"spid",freq:104,prime:0},{phon:"spat",freq:110,prime:0},{phon:"star",freq:58,prime:0},{phon:"start",freq:450,prime:0},{phon:"start^l",freq:22,prime:0},{phon:"stil",freq:51,prime:0},{phon:"stip",freq:22,prime:0},{phon:"stak",freq:165,prime:0},{phon:"stap",freq:273,prime:0},{phon:"strik",freq:20,prime:0},{phon:"strit",freq:307,prime:0},{phon:"str^k",freq:59,prime:0},{phon:"str^g^l",freq:93,prime:0},{phon:"st^did",freq:79,prime:0},{phon:"st^di",freq:391,prime:0},{phon:"stup^d",freq:25,prime:0},{phon:"s^bst^tut",freq:46,prime:0},{phon:"s^t^l",freq:26,prime:0},{phon:"s^ksid",freq:62,prime:0},{phon:"s^k",freq:20,prime:0},{phon:"su",freq:39,prime:0},{phon:"sut",freq:73,prime:0},{phon:"sut^b^l",freq:37,prime:0},{phon:"tar",freq:20,prime:0},{phon:"targ^t",freq:67,prime:0},{phon:"ti",freq:29,prime:0},{phon:"tu",freq:26162,prime:0},{phon:"tul",freq:79,prime:0},{phon:"tap",freq:212,prime:0},{phon:"trit",freq:127,prime:0},{phon:"triti",freq:24,prime:0},{phon:"tri",freq:161,prime:0},{phon:"trup",freq:82,prime:0},{phon:"trat",freq:20,prime:0},{phon:"tr^b^l",freq:189,prime:0},{phon:"tr^k",freq:84,prime:0},{phon:"tru",freq:237,prime:0},{phon:"truli",freq:237,prime:0},{phon:"tr^st",freq:76,prime:0},{phon:"tr^sti",freq:35,prime:0},{phon:"tub",freq:55,prime:0},{phon:"^gli",freq:30,prime:0},{phon:"^p",freq:1903,prime:0},{phon:"^s",freq:672,prime:0},{phon:"-",freq:1e3,prime:0}],freqNode:{},primeNode:{},continuumSpec:"",allophoneRelations:[]}),f=(e,t)=>Array.from(Array(e),(e=>Array(t).fill(0))),m=(e,t,i)=>Array.from(Array(e),(e=>Array.from(Array(t),(e=>Array(i).fill(0))))),d=e=>e.map((e=>[...e])),u=(e,t)=>{let i=0,o=0;for(;0===i;)i=Math.random();for(;0===o;)o=Math.random();return Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*o)*t+e};class g{constructor(e){this.ambiguousPhonemes=[],this.phonemes=e.map((e=>Object.assign({},e))),this.sortPhonemes();for(const[t,i]of this.phonemes.entries())console.log(`phon ${t}: ${i.label}`)}sortPhonemes(){this.phonemes.sort(((e,t)=>e.label.localeCompare(t.label)));for(const[e,t]of this.phonemes.entries())t.index=e;this.ambiguousPhonemes.sort(((e,t)=>e.label.localeCompare(t.label)));for(const[e,t]of this.ambiguousPhonemes.entries())t.index=e}sorted(){return this.phonemes}byIndex(e){return this.phonemes[e]}byLabel(e){return this.phonemes.find((t=>t.label==e))||this.ambiguousPhonemes.find((t=>t.label==e))}spreadPhons(e,t,i,o){if(e.length!=t.length)throw new Error("spread and scale parameters have different scale");i=Math.max(i,0);let a=0;const n=i=>{for(const o of i){o.spreadOffset=0;for(let i=0;i<e.length;i++){const n=e[i]*t[i]*o.durationScalar[0];n>o.spreadOffset&&(o.spreadOffset=Math.ceil(n)),a=Math.max(Math.ceil(n),a)}}};n(this.phonemes),n(this.ambiguousPhonemes);const s=t=>{for(const n of t){n.spread=f(63,4*a),n.norm=0;for(let t=0;t<63;t++)if(n.features[t]>0){const a=Math.floor(t/9),s=(n.features[t]*o-n.features[t]*i)/(e[a]*n.durationScalar[0]),r=Math.floor(e[a]*n.durationScalar[0]);for(let e=0;e<r;e++)n.spread[t][n.spreadOffset+e]=n.features[t]*o-s*e,n.spread[t][n.spreadOffset-e]=n.spread[t][n.spreadOffset+e],n.norm+=2*Math.pow(n.spread[t][n.spreadOffset+e],2)}}};s(this.phonemes),s(this.ambiguousPhonemes)}makePhonemeContinuum(e,t,i){const o=this.byLabel(e),a=this.byLabel(t);if(!o||!a||i<=1||i>g.MAX_STEPS)throw new Error("invalid arguments to makePhonemeContinuum");const n=[];for(let l=0;l<63;l++)n[l]=(a.features[l]-o.features[l])/(i-1);const s=[];for(let l=0;l<7;l++)s[l]=(a.durationScalar[l]-o.durationScalar[l])/(i-1);this.ambiguousPhonemes=[];for(let l=0;l<i;l++){const e=[];for(let i=0;i<63;i++)e[i]=o.features[i]+l*n[i];const t=[];for(let i=0;i<7;i++)t[i]=o.durationScalar[i]+l*s[i];this.ambiguousPhonemes.push({label:l.toString(),features:e,durationScalar:t,phonologicalRole:c.AMBIG})}const r=Math.floor(this.ambiguousPhonemes.length/2);this.ambiguousPhonemes.push({label:"?",features:[...this.ambiguousPhonemes[r].features],durationScalar:[...this.ambiguousPhonemes[r].durationScalar],phonologicalRole:c.AMBIG}),this.sortPhonemes()}}g.MAX_STEPS=9;const v=(e,t)=>e.RDL_rest_s?e.RDL_rest_s*Math.log10(e.RDL_rest_c*t):0;class b{constructor(e=p()){this.inputSlice=0,this.__nreps=1,this.setConfig(e),this.reset()}setConfig(e){this.config=e,this.phonemes=new g(this.config.phonology)}reset(){var e;this.lengthNormalizationScale=1/((e=this.config.lexicon.map((e=>e.phon.length))).reduce(((e,t)=>e+t))/e.length),this.inputSlice=0,this.inputLayer=f(63,this.config.fSlices),this.featLayer=f(63,this.config.fSlices),this.featNet=f(63,this.config.fSlices),this.phonLayer=f(this.config.phonology.length,this.getPSlices()),this.phonNet=f(this.config.phonology.length,this.getPSlices()),this.wordLayer=f(this.config.lexicon.length,this.getPSlices()),this.wordNet=f(this.config.lexicon.length,this.getPSlices()),this.pww=f(this.config.phonology.length,4),this.wpw=f(this.config.phonology.length,4),this.fpw=m(this.config.phonology.length,7,0),this.pfw=m(this.config.phonology.length,7,0);for(let i=0;i<this.config.phonology.length;i++)for(let e=0;e<7;e++)this.fpw[i][e]=Array(2*this.config.spread[e]).fill(0),this.pfw[i][e]=Array(2*this.config.spread[e]).fill(0);if(this.config.continuumSpec&&3==this.config.continuumSpec.trim().length){const e=+this.config.continuumSpec.trim()[2];e>1&&e<10&&this.phonemes.makePhonemeContinuum(this.config.continuumSpec.trim()[0],this.config.continuumSpec.trim()[1],e)}this.phonemes.spreadPhons(this.config.spread,this.config.spreadScale,this.config.min,this.config.max);let t=this.clamp(this.config.rest.F);for(let i=0;i<this.config.fSlices;i++)for(let e=0;e<63;e++)this.featLayer[e][i]=t;t=this.clamp(this.config.rest.P);for(let i=0;i<this.getPSlices();i++)for(let e=0;e<this.config.phonology.length;e++)this.phonLayer[e][i]=t;t=this.clamp(this.config.rest.W);for(let i=0;i<this.getWSlices();i++)for(let e=0;e<this.config.lexicon.length;e++)this.wordLayer[e][i]=t;if(this.config.freqNode.RDL_rest_s)for(let i=0;i<this.getWSlices();i++)for(let e=0;e<this.config.lexicon.length;e++)this.wordLayer[e][i]+=v(this.config.freqNode,this.config.lexicon[e].freq);if(this.config.primeNode.RDL_rest_s)for(let i=0;i<this.getWSlices();i++)for(let e=0;e<this.config.lexicon.length;e++)this.config.lexicon[e].prime>0&&(this.wordLayer[e][i]+=v(this.config.primeNode,this.config.lexicon[e].prime));this.__nreps=this.config.nreps,this.__nreps<=0&&(this.__nreps=1);for(let i=0;i<this.config.phonology.length;i++){let e=0;for(let t=0;t<=4;t++){const i=(4-Math.abs(2-t))/4;e+=i*i}for(let t=0;t<4;t++){const o=(4-Math.abs(2-t))/4;this.pww[i][t]=o/e,this.wpw[i][t]=1*o/e}}for(let i=0;i<this.config.phonology.length;i++)for(let e=0;e<7;e++){let t=0;const o=1*this.config.spread[e],a=Math.floor(o);for(let e=0;e<2*a;e++){const i=(o-Math.abs(a-e))/o;t+=i*i}for(let n=0;n<2*a;n++)this.pfw[i][e][n]=(o-Math.abs(a-n))/o,this.fpw[i][e][n]=this.pfw[i][e][n]/t}this.createInput()}getPSlices(){return Math.floor(this.config.fSlices/this.config.slicesPerPhon)}getWSlices(){return this.getPSlices()}clamp(e){return t=e,i=this.config.min,o=this.config.max,Math.min(Math.max(t,i),o);var t,i,o}createInput(){const e=this.config.modelInput.trim();console.log("TraceNet.createInput: phons="+e);let t=this.config.deltaInput;for(let i=0;i<e.length&&t<this.config.fSlices;i++)if("{"==e[i]){const o=this.phonemes.byLabel(e[++i]),a=+e[++i],n=this.phonemes.byLabel(e[++i]);i+=1;const s=t-o.spreadOffset;for(let e=s,t=0;e<s+a;e++,t++)for(let i=0;i<63;i++)e>=0&&e<this.config.fSlices&&(this.inputLayer[i][e]+=o.spread[i][t]);for(let e=s+a,t=a;e<s+2*n.spreadOffset;e++,t++)for(let i=0;i<63;i++)e>=0&&e<this.config.fSlices&&(this.inputLayer[i][e]+=n.spread[i][t]);t+=this.config.deltaInput}else{const o=this.phonemes.byLabel(e[i]),a=t-Math.round(o.spreadOffset);for(let e=a,t=0;e<a+Math.round(2*o.spreadOffset);e++,t++)for(let i=0;i<63;i++)e>=0&&e<this.config.fSlices&&(this.inputLayer[i][e]+=o.spread[i][t]);t+=Math.round(this.config.deltaInput*o.durationScalar[0])}if(0!=this.config.noiseSD)for(let i=0;i<63;i++)for(let e=0;e<this.config.fSlices;e++)this.inputLayer[i][e]+=u(0,this.config.noiseSD);for(let i=0;i<63;i++)for(let e=0;e<this.config.fSlices;e++)this.inputLayer[i][e]=this.clamp(this.inputLayer[i][e]);for(let i=0;i<7;i++)for(let e=0;e<9;e++)this.featNet[9*i+e][0]+=this.inputLayer[9*i+e][0];this.featUpdate()}actFeatures(){const e=f(7,this.config.fSlices);for(let i=0;i<7;i++)for(let t=0;t<9;t++)for(let o=0;o<this.config.fSlices;o++)this.featLayer[9*i+t][o]>0&&(e[i][o]+=this.featLayer[9*i+t][o]);const t=e.map((e=>e.map((e=>e*this.config.gamma.F))));if(this.inputSlice<this.config.fSlices)for(let i=0;i<63;i++)for(let e=this.inputSlice+1;e<this.config.fSlices&&e<this.inputSlice+1+this.__nreps;e++)this.featNet[i][e]+=this.clamp(this.config.alpha.IF*this.inputLayer[i][e]);for(let i=0;i<7;i++)for(let e=0;e<9;e++)for(let o=0;o<this.config.fSlices;o++)this.featNet[9*i+e][o]-=Math.max(0,t[i][o]-Math.max(0,this.featLayer[9*i+e][o]*this.config.gamma.F))}featToPhon(){const e=this.config.slicesPerPhon,t=this.getPSlices();for(let i=0;i<63;i++)for(let o=0;o<this.config.fSlices;o++)if(this.featLayer[i][o]>0)for(const[a,n]of this.phonemes.sorted().entries()){if(0==n.features[i])continue;const s=this.config.spread[Math.floor(i/9)],r=this.config.fSlices-s;let l,c;o<s?(l=0,c=Math.floor((o+s-1)/e)):(c=o>r?t-1:Math.floor((o+s-1)/e),l=Math.floor((o-s)/e+1));let h=s-(o-e*l),p=0;this.featLayer[i][o]>0&&(p=n.features[i]*this.featLayer[i][o]*this.config.alpha.FP);const f=Math.floor(i/9);for(let i=l;i<c+1&&i<t;i++)this.phonNet[a][i]+=this.fpw[a][f][h]*p,h+=e}}phonToPhon(){const e=this.getPSlices();let t=Array(e).fill(0),i=0,o=0;for(let a=0;a<e;a++)for(let n=0;n<this.config.phonology.length;n++)if(this.phonLayer[n][a]>0){i=a+1,i>=e?(i=e-1,o=a-1):(o=a-1,o<0&&(o=0));for(let e=o;e<i;e++)t[e]+=this.phonLayer[n][a]*this.config.gamma.P}this.globalPhonemeCompetitionIndex=0;for(let a=0;a<this.config.phonology.length;a++)for(let n=0;n<e;n++){i=n+1,i>=e?(i=e-1,o=n-1):(o=n-1,o<0&&(o=0));for(let e=o;e<i;e++)t[e]>0&&(this.phonNet[a][n]-=t[e],this.globalPhonemeCompetitionIndex+=t[e]);if(this.phonLayer[a][n]*this.config.gamma.P>0&&t[n]>0){const e=(i-o)*this.phonLayer[a][n]*this.config.gamma.P;this.phonNet[a][n]+=e,this.globalPhonemeCompetitionIndex-=e}for(let e=0;e<this.config.phonology.length;e++);}}phonToFeat(){const e=this.config.fSlices,t=this.config.slicesPerPhon;for(let i=0;i<e;i++)for(let o=0;o<7;o++)for(let a=0;a<9;a++){let n=0;for(let s=0;s<this.config.phonology.length;s++)for(let r=0;r<this.getPSlices();r++){let l=Math.floor(Math.abs(r*t-i));l>=e&&(l=e-1),this.phonLayer[s][r]>0&&(n+=this.pfw[s][o][l]*this.phonLayer[s][r]*this.phonemes.byIndex(s).features[9*o+a])}this.featNet[9*o+a][i]+=this.config.alpha.PF*n}}wordToPhon(){let e,t,i,o,a,n=this.config.lexicon;const s=this.getPSlices();for(let r=0;r<n.length;r++)for(let l=0;l<this.getWSlices();l++)if(!(this.wordLayer[r][l]<=0)){e=n[r].phon;for(let c=0;c<e.length;c++){let h=this.phonemes.byLabel(e[c]);if(t=l+2*c,i=t-1,i>=s)break;i<0?(o=1-i,i=0,a=t+2):(a=t+2,a>s-1&&(a=s-1),o=1);for(let e=i;e<a&&e<s&&o<4;e++,o++)if(this.wordLayer[r][l]>0){let t=0;n[r].freq&&this.config.freqNode.RDL_wt_s&&(t=this.config.freqNode.RDL_wt_s*Math.log10(n[r].freq));let i=0;n[r].prime&&this.config.primeNode.RDL_wt_s&&(i=this.config.primeNode.RDL_wt_s*Math.log10(n[r].prime)),this.phonNet[h.index][e]+=(1+t+i)*this.wordLayer[r][l]*this.config.alpha.WP*this.wpw[h.index][o]}}}}phonToWord(){const e=this.config.lexicon,t=this.getPSlices();let i,o,a,n,s,r;for(let l=0;l<this.config.phonology.length;l++){s=2,6==this.config.deltaInput&&3==this.config.slicesPerPhon||(s=Math.floor(this.config.deltaInput/this.config.slicesPerPhon));for(let c=0;c<t;c++)if(!(this.phonLayer[l][c]<=0))e:for(let h=0;h<e.length;h++){const p=e[h].phon;r=p.length;for(let f=0;f<r;f++)if(p.charAt(f)==this.phonemes.byIndex(l).label.charAt(0)){if(i=c-s*f,i<-s)continue e;o=1+i-s,o<0?(a=1-o,o=0,n=i+s):(n=i+s,n>t-1&&(n=t-1),a=1);let r=2*this.phonLayer[l][c]*this.config.alpha.PW,p=0;this.config.freqNode.RDL_wt_s&&e[h].freq&&(p=this.config.freqNode.RDL_wt_s*Math.log10(e[h].freq));let m=0;this.config.primeNode.RDL_wt_s&&e[h].prime&&(m=this.config.primeNode.RDL_wt_s*Math.log10(e[h].prime));for(let e=o;e<n&&e<this.getWSlices();e++,a++)a>=0&&a<4&&(this.wordNet[h][e]+=(1+p+m)*this.pww[l][a]*r)}}}}wordToWord(){const e=this.getPSlices(),t=Array(e).fill(0),i=Array(e).fill(0),o=this.config.lexicon;for(let a=0;a<e;a++)for(let t=0;t<o.length;t++){let n=a;n<0&&(n=0);let s=a+2*o[t].phon.length;
//!! wstart + (wlength*phone width) + (1/2 phone width)
s>e&&(s=e-1);for(let e=n;e<s;e++)this.wordLayer[t][a]>0&&(i[e]+=this.wordLayer[t][a]*this.wordLayer[t][a])}for(let a=0;a<e;a++)i[a]>3&&(i[a]=3),t[a]=i[a]*this.config.gamma.W;this.globalLexicalCompetitionIndex=0;for(let a=0;a<e;a++)for(let i=0;i<o.length;i++){let n=a;n<0&&(n=0);let s=a+2*o[i].phon.length;
//!! wstart + (wlength*phone width) + (1/2 phone width)
s>e&&(s=e-1);for(let e=n;e<s;e++)if(this.config.lengthNormalization){let n=1/(o[i].phon.length*this.lengthNormalizationScale);n>1&&(n=1);const s=t[e]*n;this.wordNet[i][a]-=s,this.globalLexicalCompetitionIndex+=s}else this.wordNet[i][a]-=t[e],this.globalLexicalCompetitionIndex+=t[e];if(this.wordLayer[i][a]>0)if(this.config.lengthNormalization){let e=1/(o[i].phon.length*this.lengthNormalizationScale);e>1&&(e=1);const t=(s-n)*(this.wordLayer[i][a]*this.wordLayer[i][a]*this.config.gamma.W)*e;this.wordNet[i][a]+=t,this.globalLexicalCompetitionIndex-=t}else{const e=(s-n)*(this.wordLayer[i][a]*this.wordLayer[i][a]*this.config.gamma.W);this.wordNet[i][a]+=e,this.globalLexicalCompetitionIndex-=e}}}featUpdate(){const{min:e,max:t}=this.config;for(let i=0;i<this.config.fSlices;i++)for(let o=0;o<63;o++){this.config.stochasticitySD&&(this.featNet[o][i]+=u(0,this.config.stochasticitySD));let a=this.featLayer[o][i];this.featNet[o][i]>0?a+=(t-a)*this.featNet[o][i]:this.featNet[o][i]<0&&(a+=(a-e)*this.featNet[o][i]);let n=this.featLayer[o][i]-this.config.rest.F;a-=this.config.decay.F*n,a>t&&(a=t),a<e&&(a=e),this.featLayer[o][i]=a}this.featNet=f(63,this.config.fSlices)}phonUpdate(){const e=this.getPSlices();for(let t=0;t<e;t++)for(let e=0;e<this.config.phonology.length;e++){let i;this.config.stochasticitySD&&(this.phonNet[e][t]+=u(0,this.config.stochasticitySD)),i=this.phonNet[e][t]>=0?this.config.max-this.phonLayer[e][t]:this.phonLayer[e][t]-this.config.min;const o=this.phonLayer[e][t]-this.config.rest.P;this.phonLayer[e][t]+=i*this.phonNet[e][t]-this.config.decay.P*o,this.phonLayer[e][t]=this.clamp(this.phonLayer[e][t])}this.phonNet=f(this.config.phonology.length,e)}wordUpdate(){const e=this.getWSlices(),{min:t,max:i}=this.config;for(let o=0;o<this.config.lexicon.length;o++)for(let a=0;a<e;a++){this.wordNet[o][a]*=this.config.atten,this.wordNet[o][a]-=this.config.bias,this.config.stochasticitySD&&(this.wordNet[o][a]+=u(0,this.config.stochasticitySD));let e,n=this.wordLayer[o][a];this.wordNet[o][a]>0?n+=(i-n)*this.wordNet[o][a]:this.wordNet[o][a]<0&&(n+=(n-t)*this.wordNet[o][a]),e=this.config.freqNode.RDL_rest_s&&this.config.lexicon[o].freq>0&&this.config.primeNode.RDL_rest_s&&this.config.lexicon[o].prime>0?this.wordLayer[o][a]-(this.config.rest.W+v(this.config.freqNode,this.config.lexicon[o].freq))+(this.config.rest.W+v(this.config.primeNode,this.config.lexicon[o].prime)):this.config.freqNode.RDL_rest_s&&this.config.lexicon[o].freq>0?this.wordLayer[o][a]-(this.config.rest.W+v(this.config.freqNode,this.config.lexicon[o].freq)):this.config.primeNode.RDL_rest_s&&this.config.lexicon[o].prime>0?this.wordLayer[o][a]-(this.config.rest.W+v(this.config.primeNode,this.config.lexicon[o].prime)):this.wordLayer[o][a]-this.config.rest.W,n-=this.config.decay.W*e,n>i&&(n=i),n<t&&(n=t),this.wordLayer[o][a]=n}this.wordNet=f(this.config.lexicon.length,e)}cycle(){this.actFeatures();const e=this.config.nreps<0?Math.abs(this.config.nreps):1;for(let t=0;t<e;t++)this.featToPhon(),this.phonToPhon(),this.phonToWord(),this.wordToPhon(),this.wordToWord(),this.featUpdate(),this.phonUpdate(),this.wordUpdate();this.inputSlice+=this.__nreps}}class y{constructor(e=p()){this.config=e,this.inputLayer=[],this.featLayer=[],this.phonLayer=[],this.wordLayer=[],this.globalLexicalCompetition=[],this.globalPhonemeCompetition=[],this.tn=new b(this.config),this.phonemes=this.tn.phonemes,this.maxDuration=Math.max(6*this.config.modelInput.length*this.config.deltaInput,this.config.fSlices)}getStepsRun(){return this.inputLayer.length}cycle(e){e=Math.min(this.maxDuration,e);for(let t=0;t<e;t++)this.inputLayer.push(d(this.tn.inputLayer)),this.featLayer.push(d(this.tn.featLayer)),this.phonLayer.push(d(this.tn.phonLayer)),this.wordLayer.push(d(this.tn.wordLayer)),this.globalLexicalCompetition.push(this.tn.globalLexicalCompetitionIndex),this.globalPhonemeCompetition.push(this.tn.globalPhonemeCompetitionIndex),this.tn.cycle()}}var _,x,S,C,A,P,q,w,T,k;(x=_||(_={}))[x.PHONEMES=0]="PHONEMES",x[x.WORDS=1]="WORDS",(C=S||(S={}))[C.RESPONSE_PROBABILITIES=0]="RESPONSE_PROBABILITIES",C[C.ACTIVATIONS=1]="ACTIVATIONS",C[C.COMPETITION_INDEX=2]="COMPETITION_INDEX",(P=A||(A={}))[P.AVERAGE=0]="AVERAGE",P[P.MAX_POSTHOC=1]="MAX_POSTHOC",P[P.STATIC=2]="STATIC",P[P.FRAUENFELDER=3]="FRAUENFELDER",P[P.MAX_ADHOC=4]="MAX_ADHOC",P[P.MAX_ADHOC_2=5]="MAX_ADHOC_2",(w=q||(q={}))[w.NORMAL=0]="NORMAL",w[w.FORCED=1]="FORCED",(k=T||(T={}))[k.RAW=0]="RAW",k[k.FIRST_DERIVATIVE=1]="FIRST_DERIVATIVE",k[k.SECOND_DERIVATIVE=2]="SECOND_DERIVATIVE";const I=(e,t)=>{const i=[];for(const o of e)for(const e in t)o==t[e]&&i.push(e);return i},D=(e,t,i)=>{let o=0,a=0;for(let n=t-Math.floor(i/2);n<t+Math.floor(i/2);n++)if(!(n<0)){if(n>=e.length)break;o+=e[n],a++}return o/=a,o},L=(e,t,i)=>{const o=[],a=(e=>{let t=[];for(let i=1;i<=e+1;i++)t[i-1]=i;return t})(i);for(let n=0;n<i-1;n++){let i,s=0,r=0;for(let o=Math.floor(-t/2);o<t/2&&o<e.length;o++)if(i=n+o,!(i<0)){if(i>=a.length)break;s+=(a[i]-D(a,n,t))*(e[i]-D(e,n,t)),r+=(a[i]-D(a,n,t))*(a[i]-D(a,n,t))}o[n]=s/r}return o},N=e=>{const{sim:t,domain:i=_.WORDS,itemsToWatch:o=10,calculationType:a=A.STATIC,alignment:n=4,choice:s=q.NORMAL,kValue:r=4,competType:l=T.RAW,competSlope:c=1}=e;let h;h=r<0?S.COMPETITION_INDEX:0===r?S.ACTIVATIONS:S.RESPONSE_PROBABILITIES;const p=t.getStepsRun();if(0==p)return[];if(h==S.RESPONSE_PROBABILITIES||h==S.ACTIVATIONS){let l,c,v;if(l=Array.isArray(o)?o:(e=>{const t=e.domain==_.WORDS?e.sim.config.lexicon.map((e=>e.phon)):e.sim.phonemes.sorted().map((e=>e.label));return N(Object.assign(Object.assign({},e),{itemsToWatch:t})).map(((e,i)=>[e,t[i]])).sort((([e],[t])=>Math.max(...t.data.map((e=>e.y)))-Math.max(...e.data.map((e=>e.y))))).slice(0,+e.itemsToWatch).map((([e,t])=>t))})(e),0==l.length)return[];i==_.WORDS?(c=I(l,t.config.lexicon.map((e=>e.phon))),v=t.wordLayer):(c=I(l,t.phonemes.sorted().map((e=>e.label))),v=t.phonLayer);let b=v[0].length,y=Math.floor(t.config.fSlices/t.config.slicesPerPhon),x=m(p,b,y);if(h==S.RESPONSE_PROBABILITIES)for(let e=0;e<p;e++)for(let o=0;o<b;o++)for(let a=0;a<y;a++){const n=v[e][o][a];x[e][o][a]=Math.exp(n*(r||1)),t.config.freqNode.RDL_post_c&&i==_.WORDS&&(x[e][o][a]=(d=t.config.freqNode,u=t.config.lexicon[o].freq,g=x[e][o][a],d.RDL_post_c?g*Math.log10(d.RDL_post_c+u):0))}const C=f(b,p),P=Array(b).fill(0);if(a==A.MAX_ADHOC)for(let e=0;e<b;e++)for(let t=0;t<p;t++){let i=-1e3;for(let o=0;o<y;o++)v[t][e][o]>i&&(i=v[t][e][o],C[e][t]=o)}else if(a==A.MAX_ADHOC_2)for(let e=0;e<b;e++)for(let t=0;t<p;t++){let i=-1e3;for(let o=0;o<y;o++)v[t][e][o]>i&&(i=v[t][e][o],C[e][t]=o)}else if(a==A.MAX_POSTHOC)for(let e=0;e<b;e++){let t=-1e3;for(let i=0;i<p;i++)for(let o=0;o<y;o++)v[i][e][o]>t&&(t=v[i][e][o],P[e]=o)}let w=Array(p).fill(0),T=f(p,b);if(h==S.RESPONSE_PROBABILITIES)for(let e=0;e<p;e++)if(w[e]=0,s==q.NORMAL)switch(a){case A.AVERAGE:for(let t=0;t<y;t++)for(let i=0;i<b;i++)w[e]+=x[e][i][t];break;case A.MAX_ADHOC:for(let t=0;t<b;t++)for(let i=0;i<b;i++)T[e][i]+=x[e][t][C[i][e]];break;case A.MAX_ADHOC_2:for(let t=0;t<b;t++)for(let i=0;i<b;i++)T[e][i]+=x[e][t][C[t][e]];break;case A.MAX_POSTHOC:for(let t=0;t<b;t++)w[e]+=x[e][t][P[t]];break;case A.STATIC:for(let t=0;t<b;t++)w[e]+=x[e][t][n];break;case A.FRAUENFELDER:for(let o=0;o<b;o++)for(let a=0;a<b;a++)for(let s=0;s<y;s++)if(i==_.WORDS){const i=Math.floor(t.config.deltaInput/t.config.slicesPerPhon)*t.config.lexicon[o].phon.length,r=Math.floor(t.config.deltaInput/t.config.slicesPerPhon)*t.config.lexicon[a].phon.length;(n==s||s>n&&n+i>=s||s<n&&s+r>=n)&&(T[e][o]+=x[e][a][s])}else s!=n&&s!=n-1&&s!=n+1||(T[e][o]+=x[e][o][s])}else if(s==q.FORCED)switch(a){case A.AVERAGE:for(let t=0;t<y;t++)for(let i=0;i<c.length;i++)w[e]+=x[e][c[i]][t];break;case A.MAX_ADHOC:for(let t=0;t<c.length;t++)for(let i=0;i<c.length;i++)T[e][c[t]]+=x[e][c[i]][C[c[t]][e]];break;case A.MAX_ADHOC_2:for(let t=0;t<c.length;t++)for(let i=0;i<c.length;i++)T[e][c[t]]+=x[e][c[i]][C[c[t]][e]];break;case A.MAX_POSTHOC:for(let t=0;t<c.length;t++)w[e]+=x[e][c[t]][P[c[t]]];break;case A.STATIC:for(let t=0;t<c.length;t++)w[e]+=x[e][c[t]][n];break;case A.FRAUENFELDER:for(let o=0;o<c.length;o++)for(let a=0;a<c.length;a++)for(let s=0;s<y;s++)if(i==_.WORDS){const i=Math.floor(t.config.deltaInput/t.config.slicesPerPhon)*t.config.lexicon[c[o]].phon.length,r=Math.floor(t.config.deltaInput/t.config.slicesPerPhon)*t.config.lexicon[c[a]].phon.length;(n<=s+r&&n>=s&&r>0&&i>0||s<=n+i&&s>=n&&r>0&&i>0)&&(T[e][c[o]]+=x[e][c[a]][s])}else s!=n&&s!=n-1&&s!=n+1||(T[e][c[o]]+=x[e][c[a]][s])}let k,D=f(c.length,p);for(let e=0;e<c.length;e++)for(let t=0;t<p;t++){let i,o=0;switch(i=h==S.RESPONSE_PROBABILITIES?x:v,a){case A.AVERAGE:for(let a=0;a<y;a++)o+=i[t][c[e]][a];o/=y;break;case A.MAX_ADHOC:case A.MAX_ADHOC_2:o=i[t][c[e]][C[c[e]][t]];break;case A.MAX_POSTHOC:o=i[t][c[e]][P[c[e]]];break;case A.STATIC:o=i[t][c[e]][n];break;case A.FRAUENFELDER:o=i[t][c[e]][n]+i[t][c[e]][n+1]}if(h==S.RESPONSE_PROBABILITIES)switch(a){case A.AVERAGE:D[e][t]=o/w[t];break;case A.MAX_ADHOC:case A.MAX_ADHOC_2:D[e][t]=o/T[t][c[e]];break;case A.MAX_POSTHOC:case A.STATIC:D[e][t]=o/w[t];break;case A.FRAUENFELDER:D[e][t]=o/T[t][c[e]]}else D[e][t]=o}const L=[];for(let e=0;e<c.length;e++){k=i==_.WORDS?a==A.MAX_POSTHOC?{label:`${t.config.lexicon[c[e]].phon} [${P[c[e]]}]`,data:[]}:{label:t.config.lexicon[c[e]].phon,data:[]}:{label:t.phonemes.sorted()[c[e]].label,data:[]};for(let t=0;t<p;t++)k.data.push({x:t,y:D[e][t]});L.push(k)}return L}{let e;const o=[];let a;if(i==_.WORDS?(a=t.globalLexicalCompetition,e={label:"Lexical Competition",data:[]}):(a=t.globalPhonemeCompetition,e={label:"Phoneme Competition",data:[]}),l==T.RAW){for(let t=0;t<p;t++)e.data.push({x:t,y:a[t]});o.push(e)}else if(l==T.FIRST_DERIVATIVE){const t=L(a,c,p);for(let i=0;i<t.length;i++)e.data.push({x:i,y:t[i]});o.push(e)}else if(l==T.SECOND_DERIVATIVE){const t=L(a,c,p-1),i=L(t,c,p-2);for(let o=0;o<i.length;o++)e.data.push({x:o,y:i[o]});o.push(e)}return o}var d,u,g},R=e=>e.trim().split(" ").map((e=>Number(e)||0)),E=e=>{let t='<?xml version="1.0" encoding="UTF-8"?>\n<lexicon>\n';for(const i of e){let e="  <lexeme>\n";i.label&&(e+=`    <label>${i.label}</label>\n`),e+=`    <phonology>${i.phon}</phonology>\n`,i.freq&&(e+=`    <frequency>${i.freq}</frequency>\n`),i.prime&&(e+=`    <prime>${i.prime}</prime>\n`),e+="  </lexeme>\n",t+=e}return t+="</lexicon>",t},O=Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:10}),M=e=>e.map((e=>O.format(e))).join(" "),F=e=>{let t='<?xml version="1.0" encoding="UTF-8"?>\n<phonemes>\n';for(const i of e){let e="  <phoneme>\n";e+=`    <symbol>${i.label}</symbol>\n`,e+=`    <features>${M(i.features)}</features>\n`,e+=`    <durationScalar>${M(i.features)}</durationScalar>\n`,e+="  </phoneme>\n",t+=e}return t+="</phonemes>",t};function W(e,t,i,o,a,n,s,r){var l,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=i,c._compiled=!0),o&&(c.functional=!0),n&&(c._scopeId="data-v-"+n),s?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),a&&a.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},c._ssrRegister=l):a&&(l=r?function(){a.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:a),l)if(c.functional){c._injectStyles=l;var h=c.render;c.render=function(e,t){return l.call(t),h(e,t)}}else{var p=c.beforeCreate;c.beforeCreate=p?[].concat(p,l):[l]}return{exports:e,options:c}}const $={props:{cycle:Number,cyclesToRun:Number,numCycles:Number,showCycles:Boolean,showChartOptions:Boolean,showDownloadButton:Boolean,visualize:Boolean},data:()=>({timer:null}),methods:{toggleTimer(){if(null==this.timer){const e=()=>{const e=Math.min(Math.max(this.cycle+1,0),this.numCycles-1);this.$emit("update:cycle",e),e==this.numCycles-1&&(clearInterval(this.timer),this.timer=null)};this.timer=setInterval(e,250),e()}else clearInterval(this.timer),this.timer=null}}},V={};var B=W($,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticStyle:{padding:"0.5rem"}},[e._v("\n  Cycles to Calculate\n  "),i("input",{staticClass:"input",staticStyle:{width:"50px"},attrs:{type:"text"},domProps:{value:e.cyclesToRun},on:{input:function(t){return e.$emit("update:cyclesToRun",t.target.value)}}}),e._v(" "),i("a",{staticClass:"button",on:{click:function(t){return e.$emit("run")}}},[e._v("Calculate")]),e._v(" "),e.showCycles?i("span",{staticStyle:{"margin-left":"2rem"}},[e._v("\n    cycle:\n    "),i("a",{staticClass:"button",on:{click:function(t){e.$emit("update:cycle",Math.min(Math.max(e.cycle-1,0),e.numCycles-1))}}},[e._v("-")]),e._v(" "),i("div",{staticClass:"select"},[i("select",{domProps:{value:e.cycle},on:{change:function(t){e.$emit("update:cycle",Number(t.target.value))}}},e._l(e.numCycles,(function(t,o){return i("option",{key:o,domProps:{value:o}},[e._v(e._s(o))])})),0)]),e._v(" "),i("a",{staticClass:"button",on:{click:function(t){e.$emit("update:cycle",Math.min(Math.max(e.cycle+1,0),e.numCycles-1))}}},[e._v("+")]),e._v(" "),i("a",{staticClass:"button",staticStyle:{"margin-left":"1rem"},on:{click:e.toggleTimer}},[e._v(e._s(null==e.timer?"start animation":"stop animation"))])]):e._e(),e._v(" "),e.showChartOptions?i("span",{staticStyle:{"margin-left":"2rem"}},[i("label",{staticClass:"checkbox"},[i("input",{attrs:{type:"checkbox"},domProps:{checked:e.visualize},on:{change:function(t){return e.$emit("update:visualize",t.target.checked)}}}),e._v("\n      Visualize word/phoneme activations\n    ")])]):e._e(),e._v(" "),e.showDownloadButton?i("span",{staticClass:"is-pulled-right"},[i("a",{staticClass:"button",on:{click:function(t){return e.$emit("save-data")}}},[e._v("Save data")])]):e._e()])}),[],!1,(function(e){for(let t in V)this[t]=V[t]}),null,null,null).exports;const j={};var H=W({props:["value","label","note"]},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"field is-horizontal",staticStyle:{width:"30rem"}},[i("div",{staticClass:"field-label"},[i("label",{staticClass:"label",staticStyle:{width:"10rem"}},[e._v(e._s(e.label))])]),e._v(" "),i("div",{staticClass:"field-body"},[i("div",{staticClass:"field"},[i("input",{staticClass:"input",attrs:{type:"text"},domProps:{value:e.value},on:{input:function(t){return e.$emit("input",t.target.value)}}}),e._v(" "),i("p",{staticClass:"help is-info"},[e._v(e._s(e.note))])])])])}),[],!1,(function(e){for(let t in j)this[t]=j[t]}),null,null,null).exports;const X={};var z=W({props:["config"],data(){const e=this.config.continuumSpec||"";return{enabled:!1,from:e[0]||"",to:e[1]||"",steps:parseInt(e[2],10)||1}},mounted(){this.to=this.to||this.sortedPhons[0],this.from=this.from||this.sortedPhons[1]},watch:{compiledSpec(e){this.config.continuumSpec=e}},computed:{compiledSpec(){return this.enabled&&this.from&&this.to?`${this.from}${this.to}${this.steps}`:""},sortedPhons(){return this.config.phonology.map((e=>e.label)).sort()}}},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"field is-horizontal",staticStyle:{width:"30rem"}},[e._m(0),e._v(" "),i("div",{staticClass:"field-body"},[i("label",{staticClass:"checkbox",staticStyle:{"margin-right":"10px"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.enabled,expression:"enabled"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.enabled)?e._i(e.enabled,null)>-1:e.enabled},on:{change:function(t){var i=e.enabled,o=t.target,a=!!o.checked;if(Array.isArray(i)){var n=e._i(i,null);o.checked?n<0&&(e.enabled=i.concat([null])):n>-1&&(e.enabled=i.slice(0,n).concat(i.slice(n+1)))}else e.enabled=a}}}),e._v("\n      Enabled\n    ")]),e._v(" "),i("div",{staticClass:"field",staticStyle:{"margin-right":"10px"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.steps,expression:"steps"}],staticClass:"input",attrs:{type:"number",min:"0",disabled:!e.enabled},domProps:{value:e.steps},on:{input:function(t){t.target.composing||(e.steps=t.target.value)}}}),e._v(" "),i("p",{staticClass:"help is-info"},[e._v("Number of steps")])]),e._v(" "),i("div",{staticClass:"select",staticStyle:{"margin-right":"10px"}},[i("select",{directives:[{name:"model",rawName:"v-model",value:e.from,expression:"from"}],attrs:{disabled:!e.enabled},on:{change:function(t){var i=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.from=t.target.multiple?i:i[0]}}},e._l(e.sortedPhons,(function(t,o){return i("option",{key:o},[e._v("\n          "+e._s(t)+"\n        ")])})),0),e._v(" "),i("p",{staticClass:"help is-info"},[e._v("From phoneme")])]),e._v(" "),i("div",{staticClass:"select"},[i("select",{directives:[{name:"model",rawName:"v-model",value:e.to,expression:"to"}],attrs:{disabled:!e.enabled},on:{change:function(t){var i=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.to=t.target.multiple?i:i[0]}}},e._l(e.sortedPhons,(function(t,o){return i("option",{key:o},[e._v("\n          "+e._s(t)+"\n        ")])})),0),e._v(" "),i("p",{staticClass:"help is-info"},[e._v("To phoneme")])])])])}),[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"field-label"},[i("label",{staticClass:"label",staticStyle:{width:"10rem"}},[e._v("Continuum Spec")])])}],!1,(function(e){for(let t in X)this[t]=X[t]}),null,null,null).exports;const U={};var G=W({props:{config:{type:Object,default:()=>({})}},components:{ParameterConfigInput:H,ContinuumSpec:z}},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("parameter-config-input",{attrs:{label:"Model Input",note:""},model:{value:e.config.modelInput,callback:function(t){e.$set(e.config,"modelInput",t)},expression:"config.modelInput"}}),e._v(" "),i("continuum-spec",{attrs:{config:e.config}}),e._v(" "),i("parameter-config-input",{attrs:{label:"continuumSpec",note:"Ambiguous phoneme continuum"},model:{value:e.config.continuumSpec,callback:function(t){e.$set(e.config,"continuumSpec",t)},expression:"config.continuumSpec"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"ALPHA[if]",note:"Input-Feature weights"},model:{value:e.config.alpha.IF,callback:function(t){e.$set(e.config.alpha,"IF",t)},expression:"config.alpha.IF"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"ALPHA[fp]",note:"Feature-Phoneme weights"},model:{value:e.config.alpha.FP,callback:function(t){e.$set(e.config.alpha,"FP",t)},expression:"config.alpha.FP"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"ALPHA[fw]",note:"Phoneme-Word weights"},model:{value:e.config.alpha.PW,callback:function(t){e.$set(e.config.alpha,"PW",t)},expression:"config.alpha.PW"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"ALPHA[pf]",note:"Phoneme-Feature weights"},model:{value:e.config.alpha.PF,callback:function(t){e.$set(e.config.alpha,"PF",t)},expression:"config.alpha.PF"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"ALPHA[wf]",note:"Word-Phoneme weights"},model:{value:e.config.alpha.WP,callback:function(t){e.$set(e.config.alpha,"WP",t)},expression:"config.alpha.WP"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"GAMMA[f]",note:"Feature layer inhibition"},model:{value:e.config.gamma.F,callback:function(t){e.$set(e.config.gamma,"F",t)},expression:"config.gamma.F"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"GAMMA[p]",note:"Phoneme layer inhibition"},model:{value:e.config.gamma.P,callback:function(t){e.$set(e.config.gamma,"P",t)},expression:"config.gamma.P"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"GAMMA[w]",note:"Word layer inhibition"},model:{value:e.config.gamma.W,callback:function(t){e.$set(e.config.gamma,"W",t)},expression:"config.gamma.W"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"DECAY[f]",note:"Feature decay"},model:{value:e.config.decay.F,callback:function(t){e.$set(e.config.decay,"F",t)},expression:"config.decay.F"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"DECAY[p]",note:"Phoneme decay"},model:{value:e.config.decay.P,callback:function(t){e.$set(e.config.decay,"P",t)},expression:"config.decay.P"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"DECAY[w]",note:"Word decay"},model:{value:e.config.decay.W,callback:function(t){e.$set(e.config.decay,"W",t)},expression:"config.decay.W"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"REST[f]",note:"Feature resting activation"},model:{value:e.config.rest.F,callback:function(t){e.$set(e.config.rest,"F",t)},expression:"config.rest.F"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"REST[p]",note:"Phoneme resting activation"},model:{value:e.config.rest.P,callback:function(t){e.$set(e.config.rest,"P",t)},expression:"config.rest.P"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"REST[w]",note:"Word resting activation"},model:{value:e.config.rest.W,callback:function(t){e.$set(e.config.rest,"W",t)},expression:"config.rest.W"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"Input Noise (SD)",note:""},model:{value:e.config.noiseSD,callback:function(t){e.$set(e.config,"noiseSD",t)},expression:"config.noiseSD"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"Stochasticity (SD)",note:"McClelland: 0.02"},model:{value:e.config.stochasticitySD,callback:function(t){e.$set(e.config,"stochasticitySD",t)},expression:"config.stochasticitySD"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"Attention",note:"Lexical gain"},model:{value:e.config.atten,callback:function(t){e.$set(e.config,"atten",t)},expression:"config.atten"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"Bias",note:"Lexical bias"},model:{value:e.config.bias,callback:function(t){e.$set(e.config,"bias",t)},expression:"config.bias"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"spreadScale",note:"Scales FETSPREADs"},model:{value:e.config.spreadScale[0],callback:function(t){e.$set(e.config.spreadScale,0,t)},expression:"config.spreadScale[0]"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"Min",note:"Minimum activation"},model:{value:e.config.min,callback:function(t){e.$set(e.config,"min",t)},expression:"config.min"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"Max",note:"Maximum activation"},model:{value:e.config.max,callback:function(t){e.$set(e.config,"max",t)},expression:"config.max"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"FETSPREAD[pow]",note:"Power feature spread"},model:{value:e.config.spread[0],callback:function(t){e.$set(e.config.spread,0,t)},expression:"config.spread[0]"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"FETSPREAD[voc]",note:"Vocalic feature spread"},model:{value:e.config.spread[1],callback:function(t){e.$set(e.config.spread,1,t)},expression:"config.spread[1]"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"FETSPREAD[dif]",note:"Diffuse feature spread"},model:{value:e.config.spread[2],callback:function(t){e.$set(e.config.spread,2,t)},expression:"config.spread[2]"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"FETSPREAD[acu]",note:"Accute feature spread"},model:{value:e.config.spread[3],callback:function(t){e.$set(e.config.spread,3,t)},expression:"config.spread[3]"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"FETSPREAD[gra]",note:"Gradient/Consonental feature spread"},model:{value:e.config.spread[4],callback:function(t){e.$set(e.config.spread,4,t)},expression:"config.spread[4]"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"FETSPREAD[voi]",note:"Voiced feature spread"},model:{value:e.config.spread[5],callback:function(t){e.$set(e.config.spread,5,t)},expression:"config.spread[5]"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"FETSPREAD[bur]",note:"Burst feature spread"},model:{value:e.config.spread[6],callback:function(t){e.$set(e.config.spread,6,t)},expression:"config.spread[6]"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"fSlices",note:"Number of time steps"},model:{value:e.config.fSlices,callback:function(t){e.$set(e.config,"fSlices",t)},expression:"config.fSlices"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"deltaInput",note:"Input phoneme interval"},model:{value:e.config.deltaInput,callback:function(t){e.$set(e.config,"deltaInput",t)},expression:"config.deltaInput"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"nreps",note:"Input presentation rate"},model:{value:e.config.nreps,callback:function(t){e.$set(e.config,"nreps",t)},expression:"config.nreps"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"slicesPerPhon",note:"Phoneme/Word slices per Feature"},model:{value:e.config.slicesPerPhon,callback:function(t){e.$set(e.config,"slicesPerPhon",t)},expression:"config.slicesPerPhon"}}),e._v(" "),i("parameter-config-input",{attrs:{label:"lengthNormalization",note:"0 or 1; normalize length effects."},model:{value:e.config.lengthNormalization,callback:function(t){e.$set(e.config,"lengthNormalization",t)},expression:"config.lengthNormalization"}})],1)}),[],!1,(function(e){for(let t in U)this[t]=U[t]}),null,null,null).exports;const J={};var Y=W({props:{label:{type:String,default:"Choose a file"}},methods:{loadTextFromFile(e){const t=new FileReader;t.onload=e=>this.$emit("load",e.target.result),t.readAsText(e.target.files[0])}}},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"file"},[i("label",{staticClass:"file-label"},[i("input",{staticClass:"file-input",attrs:{type:"file",name:"resume"},on:{change:e.loadTextFromFile}}),e._v(" "),i("span",{staticClass:"file-cta"},[i("span",{staticClass:"file-label"},[e._v("\n        "+e._s(e.label)+"\n      ")])])])])}),[],!1,(function(e){for(let t in J)this[t]=J[t]}),null,null,null).exports;const K={};var Q=W({components:{FileUpload:Y},props:{phonemes:{type:Array,default:()=>[]}},data:()=>({continua:["POW","VOC","DIF","ACU","GRD","VOI","BUR"],numFeatures:9,activePhoneme:null}),created(){this.activePhoneme=this.sortedPhonemes[0]},methods:{deleteSelected(){const e=this.phonemes.indexOf(this.activePhoneme),t=this.sortedPhonemes.indexOf(this.activePhoneme);e>=0&&(this.phonemes.splice(e,1),this.activePhoneme=this.sortedPhonemes[Math.min(t,this.sortedPhonemes.length-1)])},addPhoneme(){const e={label:"",features:Array(63).fill(0),durationScalar:Array(7).fill(1),phonologicalRole:c.NORMAL};this.phonemes.push(e),this.activePhoneme=e},loadJtPhonology(e){this.phonemes.splice(0,this.phonemes.length,...(e=>{const i=t.parse(e);return(i.phonemes&&i.phonemes.phoenem||[]).map((e=>({label:e.symbol,features:R(e.features),durationScalar:R(e.durationScalar),phonologicalRole:c.NORMAL})))})(e))},savePhonology(){const e=new Blob([F(this.phonemes)],{type:"application/xml"});i.saveAs(e,"phonology.jt")}},computed:{sortedPhonemes(){return[...this.phonemes].sort(((e,t)=>e.label.localeCompare(t.label)))}}},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticStyle:{display:"flex","margin-bottom":"1rem"}},[i("file-upload",{staticStyle:{"margin-right":"0.5rem"},on:{load:e.loadJtPhonology}}),e._v(" "),i("a",{staticClass:"button",on:{click:e.savePhonology}},[e._v("Save lexicon")])],1),e._v(" "),i("div",{staticClass:"columns"},[i("div",{staticClass:"column is-2"},[i("div",{staticClass:"list is-hoverable"},e._l(e.sortedPhonemes,(function(t,o){return i("a",{key:o,class:{"list-item":!0,"is-active":t===e.activePhoneme},on:{click:function(i){e.activePhoneme=t}}},[e._v("\n          "+e._s(t.label||"null")+"\n        ")])})),0),e._v(" "),i("a",{staticClass:"button",on:{click:e.addPhoneme}},[e._v("Add phoneme")]),e._v(" "),i("a",{staticClass:"button",on:{click:e.deleteSelected}},[e._v("Delete selected")])]),e._v(" "),e.activePhoneme?i("div",{staticClass:"column"},[i("div",{staticClass:"field is-horizontal",staticStyle:{width:"8rem"}},[e._m(0),e._v(" "),i("div",{staticClass:"field-body"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.activePhoneme.label,expression:"activePhoneme.label"}],staticClass:"input",attrs:{type:"text"},domProps:{value:e.activePhoneme.label},on:{input:function(t){t.target.composing||e.$set(e.activePhoneme,"label",t.target.value)}}})])]),e._v(" "),i("h1",{staticClass:"title is-5 is-marginless"},[e._v("Phoneme Specification")]),e._v(" "),i("table",{staticClass:"table is-bordered"},[i("thead",[i("tr",[i("th",[e._v("#")]),e._v(" "),e._l(e.continua,(function(t,o){return i("th",{key:o},[e._v("\n              "+e._s(t)+"\n            ")])}))],2)]),e._v(" "),i("tbody",e._l(e.numFeatures,(function(t,o){return i("tr",{key:o},[i("td",[e._v(e._s(t))]),e._v(" "),e._l(e.continua.length,(function(t,a){return i("td",{key:a,staticClass:"is-paddingless"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.activePhoneme.features[a*e.numFeatures+o],expression:"activePhoneme.features[contIndex * numFeatures + featIndex]"}],staticClass:"borderless-input",staticStyle:{width:"5rem"},attrs:{type:"text"},domProps:{value:e.activePhoneme.features[a*e.numFeatures+o]},on:{input:function(t){t.target.composing||e.$set(e.activePhoneme.features,a*e.numFeatures+o,t.target.value)}}})])}))],2)})),0)]),e._v(" "),i("h1",{staticClass:"title is-5 is-marginless"},[e._v("Duration Scalar")]),e._v(" "),i("table",{staticClass:"table is-bordered"},[i("thead",[i("tr",e._l(e.continua,(function(t,o){return i("th",{key:o},[e._v("\n              "+e._s(t)+"\n            ")])})),0)]),e._v(" "),i("tbody",[i("tr",e._l(e.continua.length,(function(t,o){return i("td",{key:o,staticClass:"is-paddingless"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.activePhoneme.durationScalar[o],expression:"activePhoneme.durationScalar[contIndex]"}],staticClass:"borderless-input",staticStyle:{width:"5rem"},attrs:{type:"text"},domProps:{value:e.activePhoneme.durationScalar[o]},on:{input:function(t){t.target.composing||e.$set(e.activePhoneme.durationScalar,o,t.target.value)}}})])})),0)])])]):e._e()])])}),[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"field-label"},[i("label",{staticClass:"label"},[e._v("Label")])])}],!1,(function(e){for(let t in K)this[t]=K[t]}),null,null,null).exports;const Z={};var ee=W({props:{lexicon:{type:Array,default:()=>[]}},methods:{loadJtLexicon(e){this.lexicon.splice(0,this.lexicon.length,...(e=>{const i=t.parse(e);return(i.lexicon&&i.lexicon.lexeme||[]).map((e=>({phon:e.phonology,freq:+e.frequency||0,label:e.label,prime:+e.prime||0})))})(e))},saveLexicon(){const e=new Blob([E(this.lexicon)],{type:"application/xml"});i.saveAs(e,"lexicon.jt")},addWord(){this.lexicon.unshift({phon:"",freq:"",prime:""})},deleteWord(e){this.lexicon.splice(e,1)},deleteAll(){this.lexicon.splice(0,this.lexicon.length)}},components:{FileUpload:Y}},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticStyle:{display:"flex","margin-bottom":"1rem"}},[i("a",{staticClass:"button",staticStyle:{"margin-right":"0.5rem"},on:{click:e.addWord}},[e._v("Add word")]),e._v(" "),i("file-upload",{staticStyle:{"margin-right":"0.5rem"},on:{load:e.loadJtLexicon}}),e._v(" "),i("a",{staticClass:"button",on:{click:e.saveLexicon}},[e._v("Save lexicon")])],1),e._v(" "),i("table",{staticClass:"table is-bordered"},[i("thead",[i("tr",[i("th",[e._v("Lexical Items")]),e._v(" "),i("th",[e._v("Frequency")]),e._v(" "),i("th",[e._v("Priming")]),e._v(" "),i("th",{staticClass:"is-paddingless"},[i("a",{staticClass:"button",on:{click:function(t){return e.deleteAll()}}},[e._v("Delete All")])])])]),e._v(" "),i("tbody",e._l(e.lexicon,(function(t,o){return i("tr",{key:o},[i("td",{staticClass:"is-paddingless"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.phon,expression:"lex.phon"}],staticClass:"borderless-input",attrs:{type:"text"},domProps:{value:t.phon},on:{input:function(i){i.target.composing||e.$set(t,"phon",i.target.value)}}})]),e._v(" "),i("td",{staticClass:"is-paddingless"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.freq,expression:"lex.freq"}],staticClass:"borderless-input",attrs:{type:"text"},domProps:{value:t.freq},on:{input:function(i){i.target.composing||e.$set(t,"freq",i.target.value)}}})]),e._v(" "),i("td",{staticClass:"is-paddingless"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.prime,expression:"lex.prime"}],staticClass:"borderless-input",attrs:{type:"text"},domProps:{value:t.prime},on:{input:function(i){i.target.composing||e.$set(t,"prime",i.target.value)}}})]),e._v(" "),i("td",{staticClass:"is-paddingless"},[i("a",{staticClass:"button is-fullwidth",on:{click:function(t){return e.deleteWord(o)}}},[e._v("Delete")])])])})),0)])])}),[],!1,(function(e){for(let t in Z)this[t]=Z[t]}),null,null,null).exports;const te={};var ie=W({props:{config:Object,default:()=>({})},data:()=>({tabs:["Parameters","Phonology","Lexicon"],activeTab:0}),components:{ParametersConfig:G,PhonemeConfig:Q,LexiconConfig:ee}},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{width:"100%"}},[i("div",{staticClass:"tabs"},[i("ul",e._l(e.tabs,(function(t,o){return i("li",{key:o,class:{"tabs-margin":!0,"is-active":e.activeTab==o}},[i("a",{on:{click:function(t){e.activeTab=o}}},[e._v(e._s(t))])])})),0)]),e._v(" "),i("div",{staticStyle:{margin:"1rem"}},[0==e.activeTab?i("parameters-config",{attrs:{config:e.config}}):e._e(),e._v(" "),1==e.activeTab?i("phoneme-config",{attrs:{phonemes:e.config.phonology}}):e._e(),e._v(" "),2==e.activeTab?i("lexicon-config",{attrs:{lexicon:e.config.lexicon}}):e._e()],1)])}),[],!1,(function(e){for(let t in te)this[t]=te[t]}),null,null,null).exports;o.controllers.box=o.DatasetController.extend({dataElementType:o.elements.Rectangle,update(e){const t=this.getMeta(),i=t.data||[];this._xScale=this.getScaleForId(t.xAxisID),this._yScale=this.getScaleForId(t.yAxisID);for(const[o,a]of i.entries())this.updateElement(a,o,e)},updateElement(e,t,i){const o=this.getDataset(),a=this.index,n=o.data[t],s=this._xScale,r=this._yScale,l=this._resolveElementOptions(e,t),c=i?s.getBasePixel():s.getPixelForValue(n,t,a),h=i?r.getBasePixel():r.getPixelForValue(n,t,a),p=l.height,f=l.width,m=p/2;e._xScale=s,e._yScale=r,e._options=l,e._datasetIndex=a,e._index=t,e._model={xCenter:c,x:c,base:h-m,y:h+m,width:f,height:p,backgroundColor:l.backgroundColor,borderColor:l.borderColor,borderSkipped:l.borderSkipped,borderWidth:l.borderWidth,word:n.word},e.pivot()},draw(){const e=this.getMeta().data||[],t=this.chart.ctx;for(const i of e){const{word:e,xCenter:o,y:a,height:n,borderColor:s}=i._model,r=10;t.save(),t.textBaseline="middle",t.textAlign="center",t.font='bold 16px "Helvetica Neue", Helvetica, Arial, sans-serif',t.fillStyle=s,i._model.width=t.measureText(e).width+2*r,i._model.x=o+i._model.width/2-r,t.fillText(e,i._model.x,a-n/2),t.restore(),i.draw()}},_resolveElementOptions(e,t){const i=this.chart,a=i.data.datasets[this.index],n=i.options.elements.rectangle,s={},r={chart:i,dataIndex:t,dataset:a,datasetIndex:this.index},l=["backgroundColor","borderColor","borderSkipped","borderWidth","width","height"];for(const c of l)s[c]=o.helpers.options.resolve([a[c],n[c]],r,t);return s}}),o.defaults.box={hover:{mode:"nearest",intersect:!0},tooltips:{mode:"nearest",intersect:!0},scales:{xAxes:[{type:"linear"}],yAxes:[{type:"linear"}]},elements:{rectangle:{borderSkipped:!1,width:20,height:20}}};const oe=["black","red","orange","green","blue","magenta","darkgray","darkgray","darkgray","darkgray"],ae={extends:a("box-chart","box"),props:{chartData:Array,chartTitle:String,xAxisTitle:String,yAxisTitle:String,numXTicks:Number,simConfig:Object,borderWidth:{type:Number,default:1}},data(){return{options:{responsive:!0,maintainAspectRatio:!1,animation:{duration:0},hover:{animationDuration:0},responsiveAnimationDuration:0,legend:{display:!1},tooltips:{enabled:!1},title:{display:!0,text:this.chartTitle},scales:{xAxes:[{ticks:{display:!0,min:0,max:this.numXTicks-1,stepSize:1},gridLines:{display:!1},scaleLabel:{display:!0,labelString:this.xAxisTitle}}],yAxes:[{ticks:{display:!0,min:0,max:1,stepSize:.1},gridLines:{display:!0},scaleLabel:{display:!0,labelString:this.yAxisTitle}}]}}}},watch:{chartData(){this.updateChart()}},mounted(){this.updateChart()},methods:{updateChart(){const e=this.chartData.slice().sort(((e,t)=>t.y-e.y)),t=[];for(const{word:a}of e)t.includes(a)||t.push(a);const i={};for(const[a,n]of t.entries())i[n]=oe[Math.min(a,oe.length-1)];const o={datasets:[{label:"My Matrix",data:this.chartData,backgroundColor:()=>"transparent",borderColor:e=>e.dataset.data[e.dataIndex]?i[e.dataset.data[e.dataIndex].word]:"transparent",borderWidth:()=>this.borderWidth,width:e=>{const{right:t,left:i}=e.chart.chartArea;return(t-i)/this.options.scales.xAxes[0].ticks.max*5},height:e=>{const{bottom:t,top:i}=e.chart.chartArea;return(t-i)/this.options.scales.yAxes[0].ticks.max/10}}]};this.renderChart(o,this.options)}}};const ne={};var se=W(ae,undefined,undefined,!1,(function(e){for(let t in ne)this[t]=ne[t]}),null,null,null).exports;const re={};var le=W({props:{chartData:Array,simConfig:Object},data:()=>({chartDataFiltered:[]}),watch:{chartData:{immediate:!0,handler(e){const{min:t,max:i}=this.simConfig,o=.01*(i-t),a=e.map(((e,t)=>[this.simConfig.lexicon.length>t?this.simConfig.lexicon[t].phon:"",e]));a.sort(((e,t)=>Math.max(...t[1])-Math.max(...e[1])));const n=a.slice(0,10),s=[];for(const[r,l]of n){let e=Number.NEGATIVE_INFINITY;for(let a=0;a<l.length;a++){const n=l[a],c=a+1<l.length?l[a+1]:Number.NEGATIVE_INFINITY;if(n>e&&n>c&&n>o){const e=(n-t)/(i-t);s.push({x:a,y:e,word:r})}e=n}}this.chartDataFiltered=s}}},components:{BoxChart:se}},(function(){var e=this,t=e.$createElement;return(e._self._c||t)("box-chart",{attrs:{"chart-data":e.chartDataFiltered,"chart-title":"Word Activations","x-axis-title":"Temporal Alignment","y-axis-title":"Activation Magnitude","num-x-ticks":Math.ceil(e.simConfig.fSlices/e.simConfig.slicesPerPhon)+1,"sim-config":e.simConfig}})}),[],!1,(function(e){for(let t in re)this[t]=re[t]}),null,null,null).exports;const ce={};var he=W({props:{chartData:Array,simConfig:Object,phonemes:Array},data:()=>({chartDataFiltered:[]}),watch:{chartData:{immediate:!0,handler(e){const{min:t,max:i}=this.simConfig,o=.02*(i-t),a=[];for(const[n,s]of e.entries())for(let e=0;e<s.length-1;e++){const r=s[e];if(r>s[e+1]&&r>o){const o=(r-t)/(i-t);a.push({x:e,y:o,word:this.phonemes.length>n?this.phonemes[n].label:"?"})}}this.chartDataFiltered=a}}},components:{BoxChart:se}},(function(){var e=this,t=e.$createElement;return(e._self._c||t)("box-chart",{attrs:{"chart-data":e.chartDataFiltered,"chart-title":"Phoneme Activations","x-axis-title":"Temporal Alignment","y-axis-title":"Activation Magnitude","num-x-ticks":Math.ceil(e.simConfig.fSlices/e.simConfig.slicesPerPhon)+1,"sim-config":e.simConfig,"border-width":0}})}),[],!1,(function(e){for(let t in ce)this[t]=ce[t]}),null,null,null).exports;const pe={extends:a("matrix-chart","matrix"),props:{chartData:Array,chartTitle:String,xAxisTitle:String,yAxisTitle:String,yLabelCallback:Function,numXTicks:Number,numYTicks:Number,yStepSize:Number,simConfig:Object},data(){return{options:{responsive:!0,maintainAspectRatio:!1,animation:{duration:0},legend:{display:!1},tooltips:{enabled:!1},title:{display:!0,text:this.chartTitle},scales:{xAxes:[{ticks:{display:!0,min:0,max:this.numXTicks-1,stepSize:1},gridLines:{display:!1},scaleLabel:{display:!0,labelString:this.xAxisTitle}}],yAxes:[{ticks:{display:!0,min:0,max:this.numYTicks,stepSize:this.yStepSize||1,callback:this.yLabelCallback||(e=>e),fontColor:"transparent"},gridLines:{display:!0},scaleLabel:{display:!0,labelString:this.yAxisTitle}}]}}}},watch:{chartData:function(){this.updateChart()}},mounted(){this.addPlugin({afterDraw:e=>{const t=e.ctx,i=e.scales["y-axis-0"],a=i.getPixelForTick(1)-i.getPixelForTick(0);o.helpers.each(i.ticks,(function(e,o){if(o===i.ticks.length-1)return;const n=i.right,s=i.getPixelForTick(o);t.save(),t.textBaseline="middle",t.textAlign="right",t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillText(e,n-10,s+a/2),t.restore()}))}}),this.updateChart()},methods:{updateChart(){const e=[];for(const[i,o]of this.chartData.entries())for(const[t,a]of o.entries())a>0&&e.push({x:t+.5,y:this.numYTicks-.5-i,v:(Math.min(Math.max(a,0),1)-this.simConfig.min)/(this.simConfig.max-this.simConfig.min)});const t={datasets:[{label:"My Matrix",data:e,backgroundColor:e=>{const t=e.dataset.data[e.dataIndex];return`rgba(0, 0, 0, ${t?t.v:0})`},width:e=>{const{right:t,left:i}=e.chart.chartArea;return(t-i)/this.options.scales.xAxes[0].ticks.max},height:e=>{const{bottom:t,top:i}=e.chart.chartArea;return(t-i)/this.options.scales.yAxes[0].ticks.max}}]};this.renderChart(t,this.options)}}};const fe={};var me=W(pe,undefined,undefined,!1,(function(e){for(let t in fe)this[t]=fe[t]}),null,null,null).exports;const de={};var ue=W({props:{chartData:Array,simConfig:Object},methods:{yLabelCallback(e,t){const i=["POW","VOC","DIF","ACU","GRD","VOI","BUR"];return t<i.length?i[t]:null}},components:{SimulationChart:me}},(function(){var e=this,t=e.$createElement;return(e._self._c||t)("simulation-chart",{attrs:{"chart-data":e.chartData,"chart-title":"Feature Activations","x-axis-title":"Temporal Alignment","y-axis-title":"Feature Continua","y-label-callback":e.yLabelCallback,"num-x-ticks":e.simConfig.fSlices+1,"num-y-ticks":63,"y-step-size":9,"sim-config":e.simConfig}})}),[],!1,(function(e){for(let t in de)this[t]=de[t]}),null,null,null).exports;const ge={};var ve=W({props:{chartData:Array,simConfig:Object},data:()=>({wordsFiltered:[],chartDataFiltered:[]}),watch:{chartData:{immediate:!0,handler(e){const t=e.map(((e,t)=>[this.simConfig.lexicon.length>t?this.simConfig.lexicon[t].phon:"",e]));t.sort(((e,t)=>Math.max(...t[1])-Math.max(...e[1])));const i=t.slice(0,10);this.wordsFiltered=i.map((([e,t])=>e)),this.chartDataFiltered=i.map((([e,t])=>t))}}},methods:{yLabelCallback(e,t){return t<this.wordsFiltered.length?this.wordsFiltered[t]:t<this.simConfig.lexicon.length?this.simConfig.lexicon[t].phon:null}},components:{SimulationChart:me}},(function(){var e=this,t=e.$createElement;return(e._self._c||t)("simulation-chart",{attrs:{"chart-data":e.chartDataFiltered,"chart-title":"Word Activations","x-axis-title":"Temporal Alignment","y-axis-title":"Word","y-label-callback":e.yLabelCallback,"num-x-ticks":Math.ceil(e.simConfig.fSlices/e.simConfig.slicesPerPhon)+1,"num-y-ticks":10,"y-step-size":1,"sim-config":e.simConfig}})}),[],!1,(function(e){for(let t in ge)this[t]=ge[t]}),null,null,null).exports;const be={};var ye=W({props:{chartData:Array,simConfig:Object},methods:{yLabelCallback(e,t){const i=["POW","VOC","DIF","ACU","GRD","VOI","BUR"];return t<i.length?i[t]:null}},components:{SimulationChart:me}},(function(){var e=this,t=e.$createElement;return(e._self._c||t)("simulation-chart",{attrs:{"chart-data":e.chartData,"chart-title":"Model Input","x-axis-title":"Time","y-axis-title":"Feature Continua","y-label-callback":e.yLabelCallback,"num-x-ticks":e.simConfig.fSlices+1,"num-y-ticks":63,"y-step-size":9,"sim-config":e.simConfig}})}),[],!1,(function(e){for(let t in be)this[t]=be[t]}),null,null,null).exports;const _e={};var xe=W({props:{chartData:Array,simConfig:Object,phonemes:Array},methods:{yLabelCallback(e,t){return t<this.phonemes.length?this.phonemes[t].label:null}},components:{SimulationChart:me}},(function(){var e=this,t=e.$createElement;return(e._self._c||t)("simulation-chart",{attrs:{"chart-data":e.chartData,"chart-title":"Phoneme Activations","x-axis-title":"Temporal Alignment","y-axis-title":"Phoneme","y-label-callback":e.yLabelCallback,"num-x-ticks":Math.ceil(e.simConfig.fSlices/e.simConfig.slicesPerPhon)+1,"num-y-ticks":e.phonemes.length,"y-step-size":1,"sim-config":e.simConfig}})}),[],!1,(function(e){for(let t in _e)this[t]=_e[t]}),null,null,null).exports;const Se={props:{simConfig:Object,phonemes:Array,featureData:Array,wordData:Array,inputData:Array,phonemeData:Array,visualize:Boolean},components:{WordBoxChart:le,PhonemeBoxChart:he,FeatureActivationsChart:ue,WordActivationsChart:ve,ModelInputChart:ye,PhonemeActivationsChart:xe}},Ce={};var Ae=W(Se,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"grid2x2"},[i("div",{staticClass:"grid-box"},[i("feature-activations-chart",{staticClass:"chart-wrapper",attrs:{"chart-data":e.featureData,"sim-config":e.simConfig}})],1),e._v(" "),i("div",{staticClass:"grid-box"},[e.visualize?i("word-box-chart",{staticClass:"chart-wrapper",attrs:{"chart-data":e.wordData,"sim-config":e.simConfig}}):i("word-activations-chart",{staticClass:"chart-wrapper",attrs:{"chart-data":e.wordData,"sim-config":e.simConfig}})],1),e._v(" "),i("div",{staticClass:"grid-box"},[i("model-input-chart",{staticClass:"chart-wrapper",attrs:{"chart-data":e.inputData,"sim-config":e.simConfig}})],1),e._v(" "),i("div",{staticClass:"grid-box"},[e.visualize?i("phoneme-box-chart",{staticClass:"chart-wrapper",attrs:{"chart-data":e.phonemeData,"sim-config":e.simConfig,phonemes:e.phonemes}}):i("phoneme-activations-chart",{staticClass:"chart-wrapper",attrs:{"chart-data":e.phonemeData,"sim-config":e.simConfig,phonemes:e.phonemes}})],1)])}),[],!1,(function(e){for(let t in Ce)this[t]=Ce[t]}),null,null,null).exports;const Pe={};var qe=W({props:{simConfig:{type:Object,required:!0},config:{type:Object,default:()=>({})}},data(){const e=this.config.itemsToWatch;return{domainWords:_.WORDS,domainPhonemes:_.PHONEMES,contentTypeResponseProbabilities:S.RESPONSE_PROBABILITIES,contentTypeActivations:S.ACTIVATIONS,contentTypeCompetitionIndex:S.COMPETITION_INDEX,competTypeRaw:T.RAW,competTypeFirstDeriv:T.FIRST_DERIVATIVE,competTypeSecondDeriv:T.SECOND_DERIVATIVE,choiceNormal:q.NORMAL,choiceForced:q.FORCED,alignments:{Average:A.AVERAGE,"Max (Ad-Hoc)":A.MAX_ADHOC,"Max (Ad-Hoc-2)":A.MAX_ADHOC_2,"Max (Post-Hoc)":A.MAX_POSTHOC,Specified:A.STATIC,"Frauenfelder (x, x+1)":A.FRAUENFELDER},itemsToWatch:new Set,numItemsToWatch:"number"==typeof e?e:10}},computed:{shouldShowAlignmentCalc(){return this.contentType!==S.COMPETITION_INDEX},shouldShowAlignment(){const{calculationType:e}=this.config;return this.shouldShowAlignmentCalc&&(e===A.FRAUENFELDER||e===A.STATIC)},shouldShowLuceChoice(){return this.contentType===S.RESPONSE_PROBABILITIES},shouldShowItems(){return this.contentType!==S.COMPETITION_INDEX},shouldShowCompetIndex(){return this.contentType===S.COMPETITION_INDEX},shouldShowCompetSlope(){return this.shouldShowCompetIndex&&this.config.competType!==T.RAW},contentType:{get:function(){return this.config.kValue<0?S.COMPETITION_INDEX:0===this.config.kValue?S.ACTIVATIONS:S.RESPONSE_PROBABILITIES},set:function(e){e===S.ACTIVATIONS?this.$set(this.config,"kValue",0):e===S.COMPETITION_INDEX?this.$set(this.config,"kValue",-1):this.$set(this.config,"kValue",4)}},useSpecifiedItems:{get:function(){return Array.isArray(this.config.itemsToWatch)},set:function(e){this.config.itemsToWatch=e?Array.from(this.itemsToWatch,(e=>e.phon)):this.numItemsToWatch}}},watch:{numItemsToWatch(e){this.useSpecifiedItems||(this.config.itemsToWatch=e)}},methods:{isWatchingItem(e){return this.itemsToWatch.has(e)},setIsWatchingItem(e,t){t?(this.itemsToWatch.add(e),this.config.itemsToWatch=Array.from(this.itemsToWatch,(e=>e.phon))):this.itemsToWatch.delete(e)}}},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"field"},[i("label",{staticClass:"label"},[e._v("Analyze")]),e._v(" "),i("div",{staticClass:"control"},[i("label",{staticClass:"radio"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.config.domain,expression:"config.domain"}],attrs:{type:"radio",name:"domain"},domProps:{value:e.domainWords,checked:e._q(e.config.domain,e.domainWords)},on:{change:function(t){return e.$set(e.config,"domain",e.domainWords)}}}),e._v("\n        Words\n      ")]),e._v(" "),i("label",{staticClass:"radio"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.config.domain,expression:"config.domain"}],attrs:{type:"radio",name:"domain"},domProps:{value:e.domainPhonemes,checked:e._q(e.config.domain,e.domainPhonemes)},on:{change:function(t){return e.$set(e.config,"domain",e.domainPhonemes)}}}),e._v("\n        Phonemes\n      ")])])]),e._v(" "),i("div",{staticClass:"field"},[i("label",{staticClass:"label"},[e._v("Content")]),e._v(" "),i("div",{staticClass:"control"},[i("div",{staticClass:"select"},[i("select",{directives:[{name:"model",rawName:"v-model",value:e.contentType,expression:"contentType"}],on:{change:function(t){var i=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.contentType=t.target.multiple?i:i[0]}}},[i("option",{domProps:{value:e.contentTypeActivations}},[e._v("Activations")]),e._v(" "),i("option",{domProps:{value:e.contentTypeResponseProbabilities}},[e._v("Response Probabilities")]),e._v(" "),i("option",{domProps:{value:e.contentTypeCompetitionIndex}},[e._v("Competition Index")])])])])]),e._v(" "),e.shouldShowItems?i("div",{staticClass:"field"},[i("label",{staticClass:"label"},[e._v("Items")]),e._v(" "),i("div",{staticClass:"control"},[i("label",{staticClass:"radio"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.useSpecifiedItems,expression:"useSpecifiedItems"}],attrs:{type:"radio",name:"items"},domProps:{value:!1,checked:e._q(e.useSpecifiedItems,!1)},on:{change:function(t){e.useSpecifiedItems=!1}}}),e._v("\n        Use top "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.numItemsToWatch,expression:"numItemsToWatch"}],staticStyle:{width:"50px"},attrs:{type:"number",disabled:e.useSpecifiedItems},domProps:{value:e.numItemsToWatch},on:{input:function(t){t.target.composing||(e.numItemsToWatch=t.target.value)}}}),e._v(" items\n      ")])]),e._v(" "),i("div",{staticClass:"control"},[i("label",{staticClass:"radio"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.useSpecifiedItems,expression:"useSpecifiedItems"}],attrs:{type:"radio",name:"items"},domProps:{value:!0,checked:e._q(e.useSpecifiedItems,!0)},on:{change:function(t){e.useSpecifiedItems=!0}}}),e._v("\n        Use selected items\n      ")])]),e._v(" "),e.useSpecifiedItems?i("div",{staticClass:"items-container"},e._l(e.simConfig.lexicon,(function(t,o){return i("div",{key:o,staticClass:"control"},[i("label",{staticClass:"checkbox"},[i("input",{attrs:{type:"checkbox"},domProps:{checked:e.isWatchingItem(t)},on:{change:function(i){return e.setIsWatchingItem(t,i.target.checked)}}}),e._v("\n          "+e._s(t.phon)+"\n        ")])])})),0):e._e()]):e._e(),e._v(" "),e.shouldShowAlignmentCalc?i("div",{staticClass:"field"},[i("label",{staticClass:"label"},[e._v("Alignment Calculation")]),e._v(" "),e._l(e.alignments,(function(t,o){return i("div",{key:t,staticClass:"control"},[i("label",{staticClass:"radio"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.config.calculationType,expression:"config.calculationType"}],attrs:{type:"radio",name:"alignment"},domProps:{value:t,checked:e._q(e.config.calculationType,t)},on:{change:function(i){return e.$set(e.config,"calculationType",t)}}}),e._v("\n        "+e._s(o)+"\n      ")])])}))],2):e._e(),e._v(" "),e.shouldShowAlignment?i("div",{staticClass:"field"},[i("label",{staticClass:"label"},[e._v("Alignment")]),e._v(" "),i("div",{staticClass:"control"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.config.alignment,expression:"config.alignment"}],staticClass:"input",attrs:{min:"0",type:"number"},domProps:{value:e.config.alignment},on:{input:function(t){t.target.composing||e.$set(e.config,"alignment",t.target.value)}}})])]):e._e(),e._v(" "),e.shouldShowLuceChoice?i("div",{staticClass:"field"},[i("label",{staticClass:"label"},[e._v("Luce Choice")]),e._v(" "),i("div",{staticClass:"control"},[i("label",{staticClass:"radio"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.config.choice,expression:"config.choice"}],attrs:{type:"radio",name:"choice"},domProps:{value:e.choiceNormal,checked:e._q(e.config.choice,e.choiceNormal)},on:{change:function(t){return e.$set(e.config,"choice",e.choiceNormal)}}}),e._v("\n        All Items\n      ")]),e._v(" "),i("label",{staticClass:"radio"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.config.choice,expression:"config.choice"}],attrs:{type:"radio",name:"choice"},domProps:{value:e.choiceForced,checked:e._q(e.config.choice,e.choiceForced)},on:{change:function(t){return e.$set(e.config,"choice",e.choiceForced)}}}),e._v("\n        Forced Choice\n      ")])]),e._v(" "),i("br"),e._v(" "),i("label",[e._v("\n      K Value\n      "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.config.kValue,expression:"config.kValue"}],staticClass:"input",staticStyle:{width:"50px"},attrs:{min:"0",type:"number"},domProps:{value:e.config.kValue},on:{input:function(t){t.target.composing||e.$set(e.config,"kValue",t.target.value)}}})])]):e._e(),e._v(" "),e.shouldShowCompetIndex?i("div",{staticClass:"field"},[i("label",{staticClass:"label"},[e._v("Global Competition Index")]),e._v(" "),i("div",{staticClass:"control"},[i("div",{staticClass:"select"},[i("select",{directives:[{name:"model",rawName:"v-model",value:e.config.competType,expression:"config.competType"}],on:{change:function(t){var i=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.config,"competType",t.target.multiple?i:i[0])}}},[i("option",{domProps:{value:e.competTypeRaw}},[e._v("Raw")]),e._v(" "),i("option",{domProps:{value:e.competTypeFirstDeriv}},[e._v("1st Derivative")]),e._v(" "),i("option",{domProps:{value:e.competTypeSecondDeriv}},[e._v("2nd Derivative")])])])])]):e._e(),e._v(" "),e.shouldShowCompetSlope?i("div",{staticClass:"field"},[i("label",{staticClass:"label"},[e._v("Sampling Width")]),e._v(" "),i("div",{staticClass:"control"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.config.competSlope,expression:"config.competSlope"}],staticClass:"input",attrs:{min:"2",type:"number"},domProps:{value:e.config.competSlope},on:{input:function(t){t.target.composing||e.$set(e.config,"competSlope",t.target.value)}}})])]):e._e()])}),[],!1,(function(e){for(let t in Pe)this[t]=Pe[t]}),null,null,null).exports;const{reactiveProp:we}=s;const Te={};var ke=W({extends:n,mixins:[we],data:()=>({options:{responsive:!0,maintainAspectRatio:!1,elements:{point:{radius:0,hitRadius:0}}}}),mounted(){this.renderChart(this.chartData,this.options)}},undefined,undefined,!1,(function(e){for(let t in Te)this[t]=Te[t]}),null,null,null).exports;const Ie={};var De=W({props:{config:{type:Object,default:()=>({})},simConfig:{type:Object,required:!0},chartData:{type:Object,default:()=>({datasets:[]})}},components:{AnalysisConfig:qe,Chart:ke}},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{display:"flex",flex:"1","min-width":"0",padding:"1rem"}},[i("div",{staticStyle:{width:"15rem"}},[i("analysis-config",{attrs:{config:e.config,"sim-config":e.simConfig}})],1),e._v(" "),i("div",{staticStyle:{"flex-grow":"1","min-width":"0"}},[i("chart",{staticClass:"wrapper",attrs:{"chart-data":e.chartData}})],1)])}),[],!1,(function(e){for(let t in Ie)this[t]=Ie[t]}),null,null,null).exports;const Le=["#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#46f0f0","#f032e6","#bcf60c","#fabebe","#008080","#e6beff","#9a6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#808080","#000000"],Ne={};var Re=W({name:"app",data:()=>({tabs:["Config","Simulation","Input","Feature","Phoneme","Word","Analysis","Analysis (Chart)"],activeTab:0,config:p(),analysisConfig:{domain:_.WORDS,itemsToWatch:10,calculationType:A.STATIC,alignment:4,choice:q.NORMAL,kValue:0,competType:T.RAW,competSlope:4},cycle:-1,cyclesToRun:60,numCycles:0,analysis:[],chartData:{datasets:[]},featureData:[],wordData:[],inputData:[],phonemeData:[],showVisualizations:!1}),created(){this.sim=new y(JSON.parse(JSON.stringify(this.config)))},computed:{phonemes(){return this.sim&&this.sim.phonemes&&this.sim.phonemes.sorted()||[]},lexicon(){return this.sim&&this.sim.config&&this.sim.config.lexicon||[]},dat(){return this.getData(this.activeTab,this.cycle,"\t")},analysisData(){return((e,t=!1)=>e.length>0?[["cycle",...e.map((e=>t?e.label.padEnd(18):e.label))].join("\t"),...Array.from(Array(e[0].data.length),((t,i)=>[i,...e.map((e=>e.data[i].y.toFixed(18)))].join("\t")))].join("\n"):"")(this.chartData.datasets,!0)}},watch:{cycle:function(){this.updateSimPage()}},methods:{run(){console.time("trace.js"),this.sim=new y(JSON.parse(JSON.stringify(this.config))),this.sim.cycle(this.cyclesToRun),this.numCycles=this.sim.getStepsRun(),this.cycle=this.clamp(this.cycle,0,this.numCycles),this.chartData={datasets:N(e(e({},this.analysisConfig),{sim:this.sim})).map(((t,i)=>e(e({},t),{fill:!1,borderColor:Le[i],showLine:!0})))},this.updateSimPage(),console.timeEnd("trace.js")},clamp:(e,t,i)=>Math.min(Math.max(e,t),i),updateSimPage(){this.cycle<0||this.numCycles<=this.cycle?(this.featureData=[],this.wordData=[],this.inputData=[],this.phonemeData=[]):(this.featureData=this.sim.featLayer[this.cycle],this.wordData=this.sim.wordLayer[this.cycle],this.inputData=this.sim.inputLayer[this.cycle],this.phonemeData=this.sim.phonLayer[this.cycle])},async saveData(){const e=new r,t=e.folder("input"),o=e.folder("feature"),a=e.folder("phoneme"),n=e.folder("word");for(let i=0;i<this.numCycles;i++)t.file(`${i.toString().padStart(4,"0")}.dat`,this.getData(2,i,", ")),o.file(`${i.toString().padStart(4,"0")}.dat`,this.getData(3,i,", ")),a.file(`${i.toString().padStart(4,"0")}.dat`,this.getData(4,i,", ")),n.file(`${i.toString().padStart(4,"0")}.dat`,this.getData(5,i,", "));e.file("analysis.dat",this.getData(6,0,", ")),i.saveAs(await e.generateAsync({type:"blob"}),"tracejs-sim.zip")},getData(e,t,i){if(!this.sim||this.cycle<0||this.numCycles<=this.cycle)return"";switch(e){case 2:return this.sim.inputLayer[t].map(((e,t)=>[t,...e.map((e=>e.toFixed(4)))].join(i))).join("\n");case 3:return this.sim.featLayer[t].map(((e,t)=>[t,...e.map((e=>e.toFixed(4)))].join(i))).join("\n");case 4:return this.sim.phonLayer[t].map(((e,t)=>[this.sim.phonemes&&this.sim.phonemes.byIndex(t).label,...e.map((e=>e.toFixed(4)))].join(i))).join("\n");case 5:return this.sim.wordLayer[t].map(((e,t)=>[this.sim.config.lexicon[t].phon,...e.map((e=>e.toFixed(4)))].join(i))).join("\n");case 6:return this.analysisData;default:return""}}},components:{SimulationToolbar:B,Config:ie,SimulationPage:Ae,Analysis:De}},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("div",{staticStyle:{flex:"0 1 auto"}},[i("section",{staticClass:"hero is-primary",staticStyle:{padding:"0.5rem 1rem 0 1rem"}},[i("div",{staticClass:"hero-foot"},[i("nav",{staticClass:"tabs is-boxed"},[i("ul",e._l(e.tabs,(function(t,o){return i("li",{key:o,class:{"is-active":e.activeTab==o}},[i("a",{on:{click:function(t){e.activeTab=o}}},[e._v(e._s(t))])])})),0)])])]),e._v(" "),0!=e.activeTab?i("simulation-toolbar",{attrs:{cycle:e.cycle,"cycles-to-run":e.cyclesToRun,"num-cycles":e.numCycles,"show-cycles":e.activeTab>0&&e.activeTab<6,visualize:e.showVisualizations,"show-chart-options":1==e.activeTab,"show-download-button":e.activeTab>0&&e.activeTab<7},on:{run:e.run,"save-data":e.saveData,"update:cycle":function(t){e.cycle=t},"update:cyclesToRun":function(t){e.cyclesToRun=t},"update:cycles-to-run":function(t){e.cyclesToRun=t},"update:visualize":function(t){e.showVisualizations=t}}}):e._e()],1),e._v(" "),0==e.activeTab?i("div",{staticStyle:{display:"flex",flex:"1 1 auto"}},[i("config",{attrs:{config:e.config}})],1):1==e.activeTab?i("div",{staticStyle:{display:"flex",flex:"1 1 auto","min-height":"0"}},[i("simulation-page",{attrs:{"sim-config":e.config,phonemes:e.phonemes,"feature-data":e.featureData,"word-data":e.wordData,"input-data":e.inputData,"phoneme-data":e.phonemeData,visualize:e.showVisualizations}})],1):7==e.activeTab?i("div",{staticStyle:{display:"flex",flex:"1 1 auto","min-height":"0"}},[i("analysis",{attrs:{"chart-data":e.chartData,config:e.analysisConfig,"sim-config":e.config}})],1):i("pre",{staticStyle:{flex:"1 1 auto",margin:"0",background:"#eee",width:"100%",overflow:"scroll"}},[e._v(e._s(e.dat))])])}),[],!1,(function(e){for(let t in Ne)this[t]=Ne[t]}),null,null,null).exports,Ee=o.helpers.options.resolve;o.controllers.matrix=o.DatasetController.extend({dataElementType:o.elements.Rectangle,update:function(e){var t,i,o=this,a=o.getMeta(),n=a.data||[];for(o._xScale=o.getScaleForId(a.xAxisID),o._yScale=o.getScaleForId(a.yAxisID),t=0,i=n.length;t<i;++t)o.updateElement(n[t],t,e)},updateElement:function(e,t,i){var o=this,a=o.getDataset(),n=o.index,s=a.data[t],r=o._xScale,l=o._yScale,c=o._resolveElementOptions(e,t),h=i?r.getBasePixel():r.getPixelForValue(s,t,n),p=i?l.getBasePixel():l.getPixelForValue(s,t,n),f=c.height,m=c.width,d=f/2;e._xScale=r,e._yScale=l,e._options=c,e._datasetIndex=n,e._index=t,e._model={x:h,base:p-d,y:p+d,width:m,height:f,backgroundColor:c.backgroundColor,borderColor:c.borderColor,borderSkipped:c.borderSkipped,borderWidth:c.borderWidth},e.pivot()},draw:function(){var e,t,i=this.getMeta().data||[];for(e=0,t=i.length;e<t;++e)i[e].draw()},_resolveElementOptions:function(e,t){var i,o,a,n=this,s=n.chart,r=s.data.datasets[n.index],l=s.options.elements.rectangle,c={},h={chart:s,dataIndex:t,dataset:r,datasetIndex:n.index},p=["backgroundColor","borderColor","borderSkipped","borderWidth","width","height"];for(i=0,o=p.length;i<o;++i)c[a=p[i]]=Ee([r[a],l[a]],h,t);return c}}),o.defaults.matrix={hover:{mode:"nearest",intersect:!0},tooltips:{mode:"nearest",intersect:!0},scales:{xAxes:[{type:"linear"}],yAxes:[{type:"linear"}]},elements:{rectangle:{borderSkipped:!1,width:20,height:20}}},console.log(o),new l({render:e=>e(Re)}).$mount("#app");
