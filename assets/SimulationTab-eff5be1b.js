import{C as I,N as W}from"./constants-431fae9a.js";import{d as C,g as b,b as y,_ as x,f as p,o as k,B as w,c as L,a as S,j as f,q as m,w as A,D as T}from"./index-65d1153e.js";import{S as D,C as E,M as V}from"./ConfigInput-77a829eb.js";import{C as v,g as j}from"./BaseChart-bf14901d.js";import{S as q}from"./SimulationToolbar-06f39a0b.js";const z=C({components:{SimulationChart:D},setup(){const t=b();return{store:t,numXTicks:I.length*W,numYTicks:W,chartData:y(()=>{var e;return((e=t.sim.value)==null?void 0:e.featLayer[t.currentCycle.value])||[]}),yLabelCallback(e,o){return o<I.length?I[o]:null}}}});function X(t,e,o,i,a,s){const n=p("SimulationChart");return k(),w(n,{"chart-data":t.chartData,"chart-title":"Feature Activations","x-axis-title":"Temporal Alignment","y-axis-title":"Feature Continua","y-label-callback":t.yLabelCallback,"num-x-ticks":t.store.config.fSlices+1,"num-y-ticks":t.numXTicks,"y-step-size":t.numYTicks,"sim-config":t.store.config},null,8,["chart-data","y-label-callback","num-x-ticks","num-y-ticks","y-step-size","sim-config"])}const O=x(z,[["render",X]]),U=C({components:{SimulationChart:D},setup(){const t=b();return{store:t,chartData:y(()=>{var e;return((e=t.sim.value)==null?void 0:e.phonLayer[t.currentCycle.value])||[]}),yLabelCallback(e,o){return o<t.sortedPhonemes.value.length?t.sortedPhonemes.value[o].label:null}}}});function Y(t,e,o,i,a,s){const n=p("SimulationChart");return k(),w(n,{"chart-data":t.chartData,"chart-title":"Phoneme Activations","x-axis-title":"Temporal Alignment","y-axis-title":"Phoneme","y-label-callback":t.yLabelCallback,"num-x-ticks":Math.ceil(t.store.config.fSlices/t.store.config.slicesPerPhon)+1,"num-y-ticks":t.store.config.phonology.length,"y-step-size":1,"sim-config":t.store.config},null,8,["chart-data","y-label-callback","num-x-ticks","num-y-ticks","sim-config"])}const R=x(U,[["render",Y]]);v.controllers.box=v.DatasetController.extend({dataElementType:v.elements.Rectangle,update(t){const e=this.getMeta(),o=e.data||[];this._xScale=this.getScaleForId(e.xAxisID),this._yScale=this.getScaleForId(e.yAxisID);for(const[i,a]of o.entries())this.updateElement(a,i,t)},updateElement(t,e){const o=this.getDataset(),i=this.index,a=o.data[e],s=this._xScale,n=this._yScale,c=this._resolveElementOptions(t,e),r=s.getPixelForTick(0),h=s.getPixelForTick(1)-r,l=F=>r+h*(a.x+F*o.characterWidth),u=l(0),d=n.getPixelForValue(a),g=l(a.word.length)-u,_=g/2,$=c.height,P=$/2;t._xScale=s,t._yScale=n,t._options=c,t._datasetIndex=i,t._index=e;const N=15;t._model={getPixelForCharacterAtIndex:l,x:u+_,base:d-P,y:d+P,width:g+N*2,height:$,backgroundColor:c.backgroundColor,borderColor:c.borderColor,borderSkipped:c.borderSkipped,borderWidth:c.borderWidth,word:a.word},t.pivot()},draw(){const t=this.getMeta().data||[],e=this.chart.ctx;for(const o of t){const{word:i,getPixelForCharacterAtIndex:a,y:s,height:n,borderColor:c}=o._model;e.save(),e.textBaseline="middle",e.textAlign="center",e.font="bold 16px monospace",e.fillStyle=c;for(let r=0;r<i.length;r++){const h=e.measureText(i[r]).width,l=a(r+1)-a(r),u=l/h,d=a(r)+l/2;e.scale(u,1),e.fillText(i[r],d/u,s-n/2),e.scale(1/u,1)}e.restore(),o.draw()}},_resolveElementOptions(t,e){const o=this.chart,a=o.data.datasets[this.index],s=o.options.elements.rectangle,n={},c={chart:o,dataIndex:e,dataset:a,datasetIndex:this.index},r=["backgroundColor","borderColor","borderSkipped","borderWidth","width","height"];for(const h of r)n[h]=v.helpers.options.resolve([a[h],s[h]],c,e);return n}});v.defaults.box={hover:{mode:"nearest",intersect:!0},tooltips:{mode:"nearest",intersect:!0},scales:{xAxes:[{type:"linear"}],yAxes:[{type:"linear"}]},elements:{rectangle:{borderSkipped:!1,width:20,height:20}}};const B=["black","red","orange","green","blue","magenta","darkgray","darkgray","darkgray","darkgray"],M=C({extends:j("box-chart","box"),props:{chartData:Array,chartTitle:String,xAxisTitle:String,yAxisTitle:String,numXTicks:Number,simConfig:Object,borderWidth:{type:Number,default:1}},data(){return{options:{responsive:!0,maintainAspectRatio:!1,animation:{duration:0},hover:{animationDuration:0},responsiveAnimationDuration:0,legend:{display:!1},tooltips:{enabled:!1},title:{display:!0,text:this.chartTitle},scales:{xAxes:[{ticks:{display:!0,min:0,max:this.numXTicks-1,stepSize:1},gridLines:{display:!1},scaleLabel:{display:!0,labelString:this.xAxisTitle}}],yAxes:[{ticks:{display:!0,min:0,max:1,stepSize:.1},gridLines:{display:!0},scaleLabel:{display:!0,labelString:this.yAxisTitle}}]}}}},computed:{characterWidth(){return this.simConfig?this.simConfig.deltaInput/this.simConfig.slicesPerPhon:1}},watch:{chartData(){this.updateChart()},characterWidth(){this.updateChart()}},mounted(){this.updateChart()},methods:{updateChart(){const t=this.chartData.slice().sort((a,s)=>s.y-a.y),e=[];for(const{word:a}of t)e.includes(a)||e.push(a);const o={};for(const[a,s]of e.entries())o[s]=B[Math.min(a,B.length-1)];const i={datasets:[{characterWidth:this.characterWidth,data:this.chartData,backgroundColor:()=>"transparent",borderColor:a=>a.dataset.data[a.dataIndex]?o[a.dataset.data[a.dataIndex].word]:"transparent",borderWidth:()=>this.borderWidth,height:a=>{const{bottom:s,top:n}=a.chart.chartArea;return(s-n)/this.options.scales.yAxes[0].ticks.max/10}}]};this.renderChart(i,this.options)}}}),G=C({components:{BoxChart:M},setup(){const t=b();return{store:t,chartData:y(()=>{var n;const e=((n=t.sim.value)==null?void 0:n.phonLayer[t.currentCycle.value])||[],{min:o,max:i}=t.config,a=(i-o)*.02,s=[];for(const[c,r]of e.entries())for(let h=0;h<r.length-1;h++){const l=r[h],u=r[h+1];if(l>u&&l>a){const d=(l-o)/(i-o);s.push({x:h,y:d,word:t.sortedPhonemes.value.length>c?t.sortedPhonemes.value[c].label:"?"})}}return s})}}});function H(t,e,o,i,a,s){const n=p("BoxChart");return k(),w(n,{"chart-data":t.chartData,"chart-title":"Phoneme Activations","x-axis-title":"Temporal Alignment","y-axis-title":"Activation Magnitude","num-x-ticks":Math.ceil(t.store.config.fSlices/t.store.config.slicesPerPhon)+1,"sim-config":t.store.config,"border-width":0},null,8,["chart-data","num-x-ticks","sim-config"])}const Z=x(G,[["render",H]]),J=C({components:{SimulationChart:D},setup(){const t=b(),e=y(()=>{var n;const s=(((n=t.sim.value)==null?void 0:n.wordLayer[t.currentCycle.value])||[]).map((c,r)=>[t.config.lexicon.length>r?t.config.lexicon[r].phon:"",c]);return s.sort((c,r)=>Math.max(...r[1])-Math.max(...c[1])),s.slice(0,10)}),o=y(()=>e.value.map(([a,s])=>a)),i=y(()=>e.value.map(([a,s])=>s));return{store:t,chartData:i,yLabelCallback(a,s){return s<o.value.length?o.value[s]:s<t.config.lexicon.length?t.config.lexicon[s].phon:null}}}});function K(t,e,o,i,a,s){const n=p("SimulationChart");return k(),w(n,{"chart-data":t.chartData,"chart-title":"Word Activations","x-axis-title":"Temporal Alignment","y-axis-title":"Word","y-label-callback":t.yLabelCallback,"num-x-ticks":Math.ceil(t.store.config.fSlices/t.store.config.slicesPerPhon)+1,"num-y-ticks":10,"y-step-size":1,"sim-config":t.store.config},null,8,["chart-data","y-label-callback","num-x-ticks","sim-config"])}const Q=x(J,[["render",K]]),tt=C({components:{BoxChart:M},setup(){const t=b();return{store:t,chartData:y(()=>{var r;const e=((r=t.sim.value)==null?void 0:r.wordLayer[t.currentCycle.value])||[],{min:o,max:i}=t.config,a=(i-o)*.01,s=e.map((h,l)=>[t.config.lexicon.length>l?t.config.lexicon[l].phon:"",h]);s.sort((h,l)=>Math.max(...l[1])-Math.max(...h[1]));const n=s.slice(0,10),c=[];for(const[h,l]of n){let u=Number.NEGATIVE_INFINITY;for(let d=0;d<l.length;d++){const g=l[d],_=d+1<l.length?l[d+1]:Number.NEGATIVE_INFINITY;if(g>u&&g>_&&g>a){const $=(g-o)/(i-o);c.push({x:d,y:$,word:h})}u=g}}return c})}}});function et(t,e,o,i,a,s){const n=p("BoxChart");return k(),w(n,{"chart-data":t.chartData,"chart-title":"Word Activations","x-axis-title":"Temporal Alignment","y-axis-title":"Activation Magnitude","num-x-ticks":Math.ceil(t.store.config.fSlices/t.store.config.slicesPerPhon)+1,"sim-config":t.store.config},null,8,["chart-data","num-x-ticks","sim-config"])}const at=x(tt,[["render",et]]),ot=C({name:"SimulationTab",components:{ConfigInput:E,SimulationToolbar:q,FeatureActivationsChart:O,WordActivationsChart:Q,WordBoxChart:at,ModelInputChart:V,PhonemeActivationsChart:R,PhonemeBoxChart:Z},setup(){const t=b();return{useBoxChart:t.useBoxChart,config:t.config}}}),st="_container_1jqsk_2",nt="_toolbar_1jqsk_8",rt="_main_1jqsk_14",it="_grid_1jqsk_21",ct={container:st,toolbar:nt,main:rt,grid:it,"chart-wrapper":"_chart-wrapper_1jqsk_28","input-wrapper":"_input-wrapper_1jqsk_36"};function lt(t,e,o,i,a,s){const n=p("SimulationToolbar"),c=p("ConfigInput"),r=p("FeatureActivationsChart"),h=p("WordActivationsChart"),l=p("WordBoxChart"),u=p("ModelInputChart"),d=p("PhonemeActivationsChart"),g=p("PhonemeBoxChart");return k(),L("div",{class:m(t.$style.container)},[S("div",{class:m(t.$style.toolbar)},[f(n,{"show-cycles":"","show-chart-options":""})],2),S("div",{class:m(t.$style["input-wrapper"])},[f(c,{modelValue:t.config.modelInput,"onUpdate:modelValue":e[0]||(e[0]=_=>t.config.modelInput=_),label:"Model Input",note:"",type:"text"},null,8,["modelValue"])],2),S("div",{class:m(t.$style.main)},[S("div",{class:m(t.$style.grid)},[f(r,{class:m(t.$style["chart-wrapper"])},null,8,["class"]),A(f(h,{class:m(t.$style["chart-wrapper"])},null,8,["class"]),[[T,!t.useBoxChart]]),A(f(l,{class:m(t.$style["chart-wrapper"])},null,8,["class"]),[[T,t.useBoxChart]]),f(u,{class:m(t.$style["chart-wrapper"])},null,8,["class"]),A(f(d,{class:m(t.$style["chart-wrapper"])},null,8,["class"]),[[T,!t.useBoxChart]]),A(f(g,{class:m(t.$style["chart-wrapper"])},null,8,["class"]),[[T,t.useBoxChart]])],2)],2)],2)}const ht={$style:ct},ft=x(ot,[["render",lt],["__cssModules",ht]]);export{ft as default};
