import{d as C,q as y,z as d,o as b,x as k,c as N,a as w,w as f,n as p,E as $,O as A}from"./vendor.b9e80e26.js";import{C as T,N as I}from"./constants.7d013e07.js";import{_ as x,g as v}from"./index.1d8391d4.js";import{S as D,C as E,M as L}from"./ConfigInput.b48c6f16.js";import{C as _,g as W}from"./BaseChart.93217dd5.js";import{S as F}from"./SimulationToolbar.f3f4b684.js";const V=C({components:{SimulationChart:D},setup(){const t=v();return{store:t,numXTicks:T.length*I,numYTicks:I,chartData:y(()=>{var e;return((e=t.sim.value)==null?void 0:e.featLayer[t.currentCycle.value])||[]}),yLabelCallback(e,a){return a<T.length?T[a]:null}}}});function z(t,e,a,i,o,s){const n=d("SimulationChart");return b(),k(n,{"chart-data":t.chartData,"chart-title":"Feature Activations","x-axis-title":"Temporal Alignment","y-axis-title":"Feature Continua","y-label-callback":t.yLabelCallback,"num-x-ticks":t.store.config.fSlices+1,"num-y-ticks":t.numXTicks,"y-step-size":t.numYTicks,"sim-config":t.store.config},null,8,["chart-data","y-label-callback","num-x-ticks","num-y-ticks","y-step-size","sim-config"])}var j=x(V,[["render",z]]);const q=C({components:{SimulationChart:D},setup(){const t=v();return{store:t,chartData:y(()=>{var e;return((e=t.sim.value)==null?void 0:e.phonLayer[t.currentCycle.value])||[]}),yLabelCallback(e,a){return a<t.sortedPhonemes.value.length?t.sortedPhonemes.value[a].label:null}}}});function O(t,e,a,i,o,s){const n=d("SimulationChart");return b(),k(n,{"chart-data":t.chartData,"chart-title":"Phoneme Activations","x-axis-title":"Temporal Alignment","y-axis-title":"Phoneme","y-label-callback":t.yLabelCallback,"num-x-ticks":Math.ceil(t.store.config.fSlices/t.store.config.slicesPerPhon)+1,"num-y-ticks":t.store.config.phonology.length,"y-step-size":1,"sim-config":t.store.config},null,8,["chart-data","y-label-callback","num-x-ticks","num-y-ticks","sim-config"])}var U=x(q,[["render",O]]);_.controllers.box=_.DatasetController.extend({dataElementType:_.elements.Rectangle,update(t){const e=this.getMeta(),a=e.data||[];this._xScale=this.getScaleForId(e.xAxisID),this._yScale=this.getScaleForId(e.yAxisID);for(const[i,o]of a.entries())this.updateElement(o,i,t)},updateElement(t,e,a){const i=this.getDataset(),o=this.index,s=i.data[e],n=this._xScale,c=this._yScale,r=this._resolveElementOptions(t,e),l=a?n.getBasePixel():n.getPixelForValue(s,e,o),h=a?c.getBasePixel():c.getPixelForValue(s,e,o),g=r.height,u=r.width,m=g/2;t._xScale=n,t._yScale=c,t._options=r,t._datasetIndex=o,t._index=e,t._model={xCenter:l,x:l,base:h-m,y:h+m,width:u,height:g,backgroundColor:r.backgroundColor,borderColor:r.borderColor,borderSkipped:r.borderSkipped,borderWidth:r.borderWidth,word:s.word},t.pivot()},draw(){const t=this.getMeta().data||[],e=this.chart.ctx;for(const a of t){const{word:i,xCenter:o,y:s,height:n,borderColor:c}=a._model,r=10;e.save(),e.textBaseline="middle",e.textAlign="center",e.font='bold 16px "Helvetica Neue", Helvetica, Arial, sans-serif',e.fillStyle=c,a._model.width=e.measureText(i).width+r*2,a._model.x=o+a._model.width/2-r,e.fillText(i,a._model.x,s-n/2),e.restore(),a.draw()}},_resolveElementOptions(t,e){const a=this.chart,o=a.data.datasets[this.index],s=a.options.elements.rectangle,n={},c={chart:a,dataIndex:e,dataset:o,datasetIndex:this.index},r=["backgroundColor","borderColor","borderSkipped","borderWidth","width","height"];for(const l of r)n[l]=_.helpers.options.resolve([o[l],s[l]],c,e);return n}});_.defaults.box={hover:{mode:"nearest",intersect:!0},tooltips:{mode:"nearest",intersect:!0},scales:{xAxes:[{type:"linear"}],yAxes:[{type:"linear"}]},elements:{rectangle:{borderSkipped:!1,width:20,height:20}}};const P=["black","red","orange","green","blue","magenta","darkgray","darkgray","darkgray","darkgray"];var B=C({extends:W("box-chart","box"),props:{chartData:Array,chartTitle:String,xAxisTitle:String,yAxisTitle:String,numXTicks:Number,simConfig:Object,borderWidth:{type:Number,default:1}},data(){return{options:{responsive:!0,maintainAspectRatio:!1,animation:{duration:0},hover:{animationDuration:0},responsiveAnimationDuration:0,legend:{display:!1},tooltips:{enabled:!1},title:{display:!0,text:this.chartTitle},scales:{xAxes:[{ticks:{display:!0,min:0,max:this.numXTicks-1,stepSize:1},gridLines:{display:!1},scaleLabel:{display:!0,labelString:this.xAxisTitle}}],yAxes:[{ticks:{display:!0,min:0,max:1,stepSize:.1},gridLines:{display:!0},scaleLabel:{display:!0,labelString:this.yAxisTitle}}]}}}},watch:{chartData(){this.updateChart()}},mounted(){this.updateChart()},methods:{updateChart(){const t=this.chartData.slice().sort((o,s)=>s.y-o.y),e=[];for(const{word:o}of t)e.includes(o)||e.push(o);const a={};for(const[o,s]of e.entries())a[s]=P[Math.min(o,P.length-1)];const i={datasets:[{label:"My Matrix",data:this.chartData,backgroundColor:()=>"transparent",borderColor:o=>o.dataset.data[o.dataIndex]?a[o.dataset.data[o.dataIndex].word]:"transparent",borderWidth:()=>this.borderWidth,width:o=>{const{right:s,left:n}=o.chart.chartArea;return(s-n)/this.options.scales.xAxes[0].ticks.max*5},height:o=>{const{bottom:s,top:n}=o.chart.chartArea;return(s-n)/this.options.scales.yAxes[0].ticks.max/10}}]};this.renderChart(i,this.options)}}});const X=C({components:{BoxChart:B},setup(){const t=v();return{store:t,chartData:y(()=>{var n;const e=((n=t.sim.value)==null?void 0:n.phonLayer[t.currentCycle.value])||[],{min:a,max:i}=t.config,o=(i-a)*.02,s=[];for(const[c,r]of e.entries())for(let l=0;l<r.length-1;l++){const h=r[l],g=r[l+1];if(h>g&&h>o){const u=(h-a)/(i-a);s.push({x:l,y:u,word:t.sortedPhonemes.value.length>c?t.sortedPhonemes.value[c].label:"?"})}}return s})}}});function Y(t,e,a,i,o,s){const n=d("BoxChart");return b(),k(n,{"chart-data":t.chartData,"chart-title":"Phoneme Activations","x-axis-title":"Temporal Alignment","y-axis-title":"Activation Magnitude","num-x-ticks":Math.ceil(t.store.config.fSlices/t.store.config.slicesPerPhon)+1,"sim-config":t.store.config,"border-width":0},null,8,["chart-data","num-x-ticks","sim-config"])}var H=x(X,[["render",Y]]);const R=C({components:{SimulationChart:D},setup(){const t=v(),e=y(()=>{var n;const s=(((n=t.sim.value)==null?void 0:n.wordLayer[t.currentCycle.value])||[]).map((c,r)=>[t.config.lexicon.length>r?t.config.lexicon[r].phon:"",c]);return s.sort((c,r)=>Math.max(...r[1])-Math.max(...c[1])),s.slice(0,10)}),a=y(()=>e.value.map(([o,s])=>o)),i=y(()=>e.value.map(([o,s])=>s));return{store:t,chartData:i,yLabelCallback(o,s){return s<a.value.length?a.value[s]:s<t.config.lexicon.length?t.config.lexicon[s].phon:null}}}});function G(t,e,a,i,o,s){const n=d("SimulationChart");return b(),k(n,{"chart-data":t.chartData,"chart-title":"Word Activations","x-axis-title":"Temporal Alignment","y-axis-title":"Word","y-label-callback":t.yLabelCallback,"num-x-ticks":Math.ceil(t.store.config.fSlices/t.store.config.slicesPerPhon)+1,"num-y-ticks":10,"y-step-size":1,"sim-config":t.store.config},null,8,["chart-data","y-label-callback","num-x-ticks","sim-config"])}var J=x(R,[["render",G]]);const K=C({components:{BoxChart:B},setup(){const t=v();return{store:t,chartData:y(()=>{var r;const e=((r=t.sim.value)==null?void 0:r.wordLayer[t.currentCycle.value])||[],{min:a,max:i}=t.config,o=(i-a)*.01,s=e.map((l,h)=>[t.config.lexicon.length>h?t.config.lexicon[h].phon:"",l]);s.sort((l,h)=>Math.max(...h[1])-Math.max(...l[1]));const n=s.slice(0,10),c=[];for(const[l,h]of n){let g=Number.NEGATIVE_INFINITY;for(let u=0;u<h.length;u++){const m=h[u],S=u+1<h.length?h[u+1]:Number.NEGATIVE_INFINITY;if(m>g&&m>S&&m>o){const M=(m-a)/(i-a);c.push({x:u,y:M,word:l})}g=m}}return c})}}});function Q(t,e,a,i,o,s){const n=d("BoxChart");return b(),k(n,{"chart-data":t.chartData,"chart-title":"Word Activations","x-axis-title":"Temporal Alignment","y-axis-title":"Activation Magnitude","num-x-ticks":Math.ceil(t.store.config.fSlices/t.store.config.slicesPerPhon)+1,"sim-config":t.store.config},null,8,["chart-data","num-x-ticks","sim-config"])}var Z=x(K,[["render",Q]]);const tt="_container_1jqsk_2",et="_toolbar_1jqsk_8",at="_main_1jqsk_14",ot="_grid_1jqsk_21";var st={container:tt,toolbar:et,main:at,grid:ot,"chart-wrapper":"_chart-wrapper_1jqsk_28","input-wrapper":"_input-wrapper_1jqsk_36"};const nt=C({name:"SimulationTab",components:{ConfigInput:E,SimulationToolbar:F,FeatureActivationsChart:j,WordActivationsChart:J,WordBoxChart:Z,ModelInputChart:L,PhonemeActivationsChart:U,PhonemeBoxChart:H},setup(){const t=v();return{useBoxChart:t.useBoxChart,config:t.config}}});function rt(t,e,a,i,o,s){const n=d("SimulationToolbar"),c=d("ConfigInput"),r=d("FeatureActivationsChart"),l=d("WordActivationsChart"),h=d("WordBoxChart"),g=d("ModelInputChart"),u=d("PhonemeActivationsChart"),m=d("PhonemeBoxChart");return b(),N("div",{class:p(t.$style.container)},[w("div",{class:p(t.$style.toolbar)},[f(n,{"show-cycles":"","show-chart-options":""})],2),w("div",{class:p(t.$style["input-wrapper"])},[f(c,{modelValue:t.config.modelInput,"onUpdate:modelValue":e[0]||(e[0]=S=>t.config.modelInput=S),label:"Model Input",note:"",type:"text"},null,8,["modelValue"])],2),w("div",{class:p(t.$style.main)},[w("div",{class:p(t.$style.grid)},[f(r,{class:p(t.$style["chart-wrapper"])},null,8,["class"]),$(f(l,{class:p(t.$style["chart-wrapper"])},null,8,["class"]),[[A,!t.useBoxChart]]),$(f(h,{class:p(t.$style["chart-wrapper"])},null,8,["class"]),[[A,t.useBoxChart]]),f(g,{class:p(t.$style["chart-wrapper"])},null,8,["class"]),$(f(u,{class:p(t.$style["chart-wrapper"])},null,8,["class"]),[[A,!t.useBoxChart]]),$(f(m,{class:p(t.$style["chart-wrapper"])},null,8,["class"]),[[A,t.useBoxChart]])],2)],2)],2)}const it={$style:st};var mt=x(nt,[["render",rt],["__cssModules",it]]);export{mt as default};
